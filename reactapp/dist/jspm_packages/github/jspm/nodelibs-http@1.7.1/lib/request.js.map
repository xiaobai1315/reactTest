{"version":3,"sources":["../../../../../../jspm_packages/github/jspm/nodelibs-http@1.7.1/lib/request.js"],"names":["Stream","require","Response","Base64","inherits","Request","module","exports","xhr","params","self","writable","body","uri","protocol","host","port","path","withCredentials","e","responseType","open","method","onerror","event","emit","Error","_headers","headers","keys","objectKeys","i","length","key","isSafeRequestHeader","value","setHeader","auth","btoa","res","on","err","onreadystatechange","__aborted","handle","prototype","toLowerCase","getHeader","removeHeader","write","s","push","destroy","abort","end","undefined","isArray","j","setRequestHeader","send","join","apply","test","Object","toString","call","len","constructor","k","b","isXHR2Compatible","unsafeHeaders","headerName","indexOf","obj","Array","xs","x","Blob","ArrayBuffer","FormData"],"mappings":"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","file":"request.js","sourcesContent":["/* */ \nvar Stream = require('stream');\nvar Response = require('./response');\nvar Base64 = require('Base64');\nvar inherits = require('inherits');\nvar Request = module.exports = function(xhr, params) {\n  var self = this;\n  self.writable = true;\n  self.xhr = xhr;\n  self.body = [];\n  self.uri = (params.protocol || 'http:') + '//' + params.host + (params.port ? ':' + params.port : '') + (params.path || '/');\n  ;\n  if (typeof params.withCredentials === 'undefined') {\n    params.withCredentials = true;\n  }\n  try {\n    xhr.withCredentials = params.withCredentials;\n  } catch (e) {}\n  if (params.responseType)\n    try {\n      xhr.responseType = params.responseType;\n    } catch (e) {}\n  xhr.open(params.method || 'GET', self.uri, true);\n  xhr.onerror = function(event) {\n    self.emit('error', new Error('Network error'));\n  };\n  self._headers = {};\n  if (params.headers) {\n    var keys = objectKeys(params.headers);\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      if (!self.isSafeRequestHeader(key))\n        continue;\n      var value = params.headers[key];\n      self.setHeader(key, value);\n    }\n  }\n  if (params.auth) {\n    this.setHeader('Authorization', 'Basic ' + Base64.btoa(params.auth));\n  }\n  var res = new Response;\n  res.on('close', function() {\n    self.emit('close');\n  });\n  res.on('ready', function() {\n    self.emit('response', res);\n  });\n  res.on('error', function(err) {\n    self.emit('error', err);\n  });\n  xhr.onreadystatechange = function() {\n    if (xhr.__aborted)\n      return;\n    res.handle(xhr);\n  };\n};\ninherits(Request, Stream);\nRequest.prototype.setHeader = function(key, value) {\n  this._headers[key.toLowerCase()] = value;\n};\nRequest.prototype.getHeader = function(key) {\n  return this._headers[key.toLowerCase()];\n};\nRequest.prototype.removeHeader = function(key) {\n  delete this._headers[key.toLowerCase()];\n};\nRequest.prototype.write = function(s) {\n  this.body.push(s);\n};\nRequest.prototype.destroy = function(s) {\n  this.xhr.__aborted = true;\n  this.xhr.abort();\n  this.emit('close');\n};\nRequest.prototype.end = function(s) {\n  if (s !== undefined)\n    this.body.push(s);\n  var keys = objectKeys(this._headers);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = this._headers[key];\n    if (isArray(value)) {\n      for (var j = 0; j < value.length; j++) {\n        this.xhr.setRequestHeader(key, value[j]);\n      }\n    } else\n      this.xhr.setRequestHeader(key, value);\n  }\n  if (this.body.length === 0) {\n    this.xhr.send('');\n  } else if (typeof this.body[0] === 'string') {\n    this.xhr.send(this.body.join(''));\n  } else if (isArray(this.body[0])) {\n    var body = [];\n    for (var i = 0; i < this.body.length; i++) {\n      body.push.apply(body, this.body[i]);\n    }\n    this.xhr.send(body);\n  } else if (/Array/.test(Object.prototype.toString.call(this.body[0]))) {\n    var len = 0;\n    for (var i = 0; i < this.body.length; i++) {\n      len += this.body[i].length;\n    }\n    var body = new (this.body[0].constructor)(len);\n    var k = 0;\n    for (var i = 0; i < this.body.length; i++) {\n      var b = this.body[i];\n      for (var j = 0; j < b.length; j++) {\n        body[k++] = b[j];\n      }\n    }\n    this.xhr.send(body);\n  } else if (isXHR2Compatible(this.body[0])) {\n    this.xhr.send(this.body[0]);\n  } else {\n    var body = '';\n    for (var i = 0; i < this.body.length; i++) {\n      body += this.body[i].toString();\n    }\n    this.xhr.send(body);\n  }\n};\nRequest.unsafeHeaders = [\"accept-charset\", \"accept-encoding\", \"access-control-request-headers\", \"access-control-request-method\", \"connection\", \"content-length\", \"cookie\", \"cookie2\", \"content-transfer-encoding\", \"date\", \"expect\", \"host\", \"keep-alive\", \"origin\", \"referer\", \"te\", \"trailer\", \"transfer-encoding\", \"upgrade\", \"user-agent\", \"via\"];\nRequest.prototype.isSafeRequestHeader = function(headerName) {\n  if (!headerName)\n    return false;\n  return indexOf(Request.unsafeHeaders, headerName.toLowerCase()) === -1;\n};\nvar objectKeys = Object.keys || function(obj) {\n  var keys = [];\n  for (var key in obj)\n    keys.push(key);\n  return keys;\n};\nvar isArray = Array.isArray || function(xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\nvar indexOf = function(xs, x) {\n  if (xs.indexOf)\n    return xs.indexOf(x);\n  for (var i = 0; i < xs.length; i++) {\n    if (xs[i] === x)\n      return i;\n  }\n  return -1;\n};\nvar isXHR2Compatible = function(obj) {\n  if (typeof Blob !== 'undefined' && obj instanceof Blob)\n    return true;\n  if (typeof ArrayBuffer !== 'undefined' && obj instanceof ArrayBuffer)\n    return true;\n  if (typeof FormData !== 'undefined' && obj instanceof FormData)\n    return true;\n};\n"]}