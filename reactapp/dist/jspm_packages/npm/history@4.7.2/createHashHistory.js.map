{"version":3,"sources":["../../../../jspm_packages/npm/history@4.7.2/createHashHistory.js"],"names":["exports","__esModule","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_warning","require","_warning2","_interopRequireDefault","_invariant","_invariant2","_LocationUtils","_PathUtils","_createTransitionManager","_createTransitionManager2","_DOMUtils","obj","default","HashChangeEvent","HashPathCoders","hashbang","encodePath","path","charAt","stripLeadingSlash","decodePath","substr","noslash","addLeadingSlash","slash","getHashPath","href","window","location","hashIndex","indexOf","substring","pushHashPath","hash","replaceHashPath","replace","slice","createHashHistory","props","undefined","canUseDOM","globalHistory","history","canGoWithoutReload","supportsGoWithoutReloadUsingHash","_props$getUserConfirm","getUserConfirmation","getConfirmation","_props$hashType","hashType","basename","stripTrailingSlash","_HashPathCoders$hashT","getDOMLocation","hasBasename","stripBasename","createLocation","transitionManager","setState","nextState","notifyListeners","action","forceNextPop","ignorePath","handleHashChange","encodedPath","prevLocation","locationsAreEqual","createPath","handlePop","confirmTransitionTo","ok","revertPop","fromLocation","toLocation","toIndex","allPaths","lastIndexOf","fromIndex","delta","go","initialLocation","createHref","push","state","hashChanged","prevIndex","nextPaths","n","goBack","goForward","listenerCount","checkDOMListeners","addEventListener","removeEventListener","isBlocked","block","prompt","unblock","setPrompt","listen","listener","unlisten","appendListener"],"mappings":"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","file":"createHashHistory.js","sourcesContent":["/* */ \n'use strict';\nexports.__esModule = true;\nvar _extends = Object.assign || function(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n};\nvar _warning = require('warning');\nvar _warning2 = _interopRequireDefault(_warning);\nvar _invariant = require('invariant');\nvar _invariant2 = _interopRequireDefault(_invariant);\nvar _LocationUtils = require('./LocationUtils');\nvar _PathUtils = require('./PathUtils');\nvar _createTransitionManager = require('./createTransitionManager');\nvar _createTransitionManager2 = _interopRequireDefault(_createTransitionManager);\nvar _DOMUtils = require('./DOMUtils');\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\nvar HashChangeEvent = 'hashchange';\nvar HashPathCoders = {\n  hashbang: {\n    encodePath: function encodePath(path) {\n      return path.charAt(0) === '!' ? path : '!/' + (0, _PathUtils.stripLeadingSlash)(path);\n    },\n    decodePath: function decodePath(path) {\n      return path.charAt(0) === '!' ? path.substr(1) : path;\n    }\n  },\n  noslash: {\n    encodePath: _PathUtils.stripLeadingSlash,\n    decodePath: _PathUtils.addLeadingSlash\n  },\n  slash: {\n    encodePath: _PathUtils.addLeadingSlash,\n    decodePath: _PathUtils.addLeadingSlash\n  }\n};\nvar getHashPath = function getHashPath() {\n  var href = window.location.href;\n  var hashIndex = href.indexOf('#');\n  return hashIndex === -1 ? '' : href.substring(hashIndex + 1);\n};\nvar pushHashPath = function pushHashPath(path) {\n  return window.location.hash = path;\n};\nvar replaceHashPath = function replaceHashPath(path) {\n  var hashIndex = window.location.href.indexOf('#');\n  window.location.replace(window.location.href.slice(0, hashIndex >= 0 ? hashIndex : 0) + '#' + path);\n};\nvar createHashHistory = function createHashHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  (0, _invariant2.default)(_DOMUtils.canUseDOM, 'Hash history needs a DOM');\n  var globalHistory = window.history;\n  var canGoWithoutReload = (0, _DOMUtils.supportsGoWithoutReloadUsingHash)();\n  var _props$getUserConfirm = props.getUserConfirmation,\n      getUserConfirmation = _props$getUserConfirm === undefined ? _DOMUtils.getConfirmation : _props$getUserConfirm,\n      _props$hashType = props.hashType,\n      hashType = _props$hashType === undefined ? 'slash' : _props$hashType;\n  var basename = props.basename ? (0, _PathUtils.stripTrailingSlash)((0, _PathUtils.addLeadingSlash)(props.basename)) : '';\n  var _HashPathCoders$hashT = HashPathCoders[hashType],\n      encodePath = _HashPathCoders$hashT.encodePath,\n      decodePath = _HashPathCoders$hashT.decodePath;\n  var getDOMLocation = function getDOMLocation() {\n    var path = decodePath(getHashPath());\n    (0, _warning2.default)(!basename || (0, _PathUtils.hasBasename)(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path \"' + path + '\" to begin with \"' + basename + '\".');\n    if (basename)\n      path = (0, _PathUtils.stripBasename)(path, basename);\n    return (0, _LocationUtils.createLocation)(path);\n  };\n  var transitionManager = (0, _createTransitionManager2.default)();\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n    history.length = globalHistory.length;\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n  var forceNextPop = false;\n  var ignorePath = null;\n  var handleHashChange = function handleHashChange() {\n    var path = getHashPath();\n    var encodedPath = encodePath(path);\n    if (path !== encodedPath) {\n      replaceHashPath(encodedPath);\n    } else {\n      var location = getDOMLocation();\n      var prevLocation = history.location;\n      if (!forceNextPop && (0, _LocationUtils.locationsAreEqual)(prevLocation, location))\n        return;\n      if (ignorePath === (0, _PathUtils.createPath)(location))\n        return;\n      ignorePath = null;\n      handlePop(location);\n    }\n  };\n  var handlePop = function handlePop(location) {\n    if (forceNextPop) {\n      forceNextPop = false;\n      setState();\n    } else {\n      var action = 'POP';\n      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n        if (ok) {\n          setState({\n            action: action,\n            location: location\n          });\n        } else {\n          revertPop(location);\n        }\n      });\n    }\n  };\n  var revertPop = function revertPop(fromLocation) {\n    var toLocation = history.location;\n    var toIndex = allPaths.lastIndexOf((0, _PathUtils.createPath)(toLocation));\n    if (toIndex === -1)\n      toIndex = 0;\n    var fromIndex = allPaths.lastIndexOf((0, _PathUtils.createPath)(fromLocation));\n    if (fromIndex === -1)\n      fromIndex = 0;\n    var delta = toIndex - fromIndex;\n    if (delta) {\n      forceNextPop = true;\n      go(delta);\n    }\n  };\n  var path = getHashPath();\n  var encodedPath = encodePath(path);\n  if (path !== encodedPath)\n    replaceHashPath(encodedPath);\n  var initialLocation = getDOMLocation();\n  var allPaths = [(0, _PathUtils.createPath)(initialLocation)];\n  var createHref = function createHref(location) {\n    return '#' + encodePath(basename + (0, _PathUtils.createPath)(location));\n  };\n  var push = function push(path, state) {\n    (0, _warning2.default)(state === undefined, 'Hash history cannot push state; it is ignored');\n    var action = 'PUSH';\n    var location = (0, _LocationUtils.createLocation)(path, undefined, undefined, history.location);\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n      if (!ok)\n        return;\n      var path = (0, _PathUtils.createPath)(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n      if (hashChanged) {\n        ignorePath = path;\n        pushHashPath(encodedPath);\n        var prevIndex = allPaths.lastIndexOf((0, _PathUtils.createPath)(history.location));\n        var nextPaths = allPaths.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);\n        nextPaths.push(path);\n        allPaths = nextPaths;\n        setState({\n          action: action,\n          location: location\n        });\n      } else {\n        (0, _warning2.default)(false, 'Hash history cannot PUSH the same path; a new entry will not be added to the history stack');\n        setState();\n      }\n    });\n  };\n  var replace = function replace(path, state) {\n    (0, _warning2.default)(state === undefined, 'Hash history cannot replace state; it is ignored');\n    var action = 'REPLACE';\n    var location = (0, _LocationUtils.createLocation)(path, undefined, undefined, history.location);\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n      if (!ok)\n        return;\n      var path = (0, _PathUtils.createPath)(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n      if (hashChanged) {\n        ignorePath = path;\n        replaceHashPath(encodedPath);\n      }\n      var prevIndex = allPaths.indexOf((0, _PathUtils.createPath)(history.location));\n      if (prevIndex !== -1)\n        allPaths[prevIndex] = path;\n      setState({\n        action: action,\n        location: location\n      });\n    });\n  };\n  var go = function go(n) {\n    (0, _warning2.default)(canGoWithoutReload, 'Hash history go(n) causes a full page reload in this browser');\n    globalHistory.go(n);\n  };\n  var goBack = function goBack() {\n    return go(-1);\n  };\n  var goForward = function goForward() {\n    return go(1);\n  };\n  var listenerCount = 0;\n  var checkDOMListeners = function checkDOMListeners(delta) {\n    listenerCount += delta;\n    if (listenerCount === 1) {\n      (0, _DOMUtils.addEventListener)(window, HashChangeEvent, handleHashChange);\n    } else if (listenerCount === 0) {\n      (0, _DOMUtils.removeEventListener)(window, HashChangeEvent, handleHashChange);\n    }\n  };\n  var isBlocked = false;\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var unblock = transitionManager.setPrompt(prompt);\n    if (!isBlocked) {\n      checkDOMListeners(1);\n      isBlocked = true;\n    }\n    return function() {\n      if (isBlocked) {\n        isBlocked = false;\n        checkDOMListeners(-1);\n      }\n      return unblock();\n    };\n  };\n  var listen = function listen(listener) {\n    var unlisten = transitionManager.appendListener(listener);\n    checkDOMListeners(1);\n    return function() {\n      checkDOMListeners(-1);\n      unlisten();\n    };\n  };\n  var history = {\n    length: globalHistory.length,\n    action: 'POP',\n    location: initialLocation,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    block: block,\n    listen: listen\n  };\n  return history;\n};\nexports.default = createHashHistory;\n"]}