{"version":3,"sources":["../../../../jspm_packages/npm/history@4.7.2/createBrowserHistory.js"],"names":["exports","__esModule","_typeof","Symbol","iterator","obj","constructor","prototype","_extends","Object","assign","target","i","arguments","length","source","key","hasOwnProperty","call","_warning","require","_warning2","_interopRequireDefault","_invariant","_invariant2","_LocationUtils","_PathUtils","_createTransitionManager","_createTransitionManager2","_DOMUtils","default","PopStateEvent","HashChangeEvent","getHistoryState","window","history","state","e","createBrowserHistory","props","undefined","canUseDOM","globalHistory","canUseHistory","supportsHistory","needsHashChangeListener","supportsPopStateOnHashChange","_props$forceRefresh","forceRefresh","_props$getUserConfirm","getUserConfirmation","getConfirmation","_props$keyLength","keyLength","basename","stripTrailingSlash","addLeadingSlash","getDOMLocation","historyState","_ref","_window$location","location","pathname","search","hash","path","hasBasename","stripBasename","createLocation","createKey","Math","random","toString","substr","transitionManager","setState","nextState","notifyListeners","action","handlePopState","event","isExtraneousPopstateEvent","handlePop","handleHashChange","forceNextPop","confirmTransitionTo","ok","revertPop","fromLocation","toLocation","toIndex","allKeys","indexOf","fromIndex","delta","go","initialLocation","createHref","createPath","push","href","pushState","prevIndex","nextKeys","slice","replace","replaceState","n","goBack","goForward","listenerCount","checkDOMListeners","addEventListener","removeEventListener","isBlocked","block","prompt","unblock","setPrompt","listen","listener","unlisten","appendListener"],"mappings":"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","file":"createBrowserHistory.js","sourcesContent":["/* */ \n'use strict';\nexports.__esModule = true;\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function(obj) {\n  return typeof obj;\n} : function(obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\nvar _extends = Object.assign || function(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n};\nvar _warning = require('warning');\nvar _warning2 = _interopRequireDefault(_warning);\nvar _invariant = require('invariant');\nvar _invariant2 = _interopRequireDefault(_invariant);\nvar _LocationUtils = require('./LocationUtils');\nvar _PathUtils = require('./PathUtils');\nvar _createTransitionManager = require('./createTransitionManager');\nvar _createTransitionManager2 = _interopRequireDefault(_createTransitionManager);\nvar _DOMUtils = require('./DOMUtils');\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\nvar PopStateEvent = 'popstate';\nvar HashChangeEvent = 'hashchange';\nvar getHistoryState = function getHistoryState() {\n  try {\n    return window.history.state || {};\n  } catch (e) {\n    return {};\n  }\n};\nvar createBrowserHistory = function createBrowserHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  (0, _invariant2.default)(_DOMUtils.canUseDOM, 'Browser history needs a DOM');\n  var globalHistory = window.history;\n  var canUseHistory = (0, _DOMUtils.supportsHistory)();\n  var needsHashChangeListener = !(0, _DOMUtils.supportsPopStateOnHashChange)();\n  var _props$forceRefresh = props.forceRefresh,\n      forceRefresh = _props$forceRefresh === undefined ? false : _props$forceRefresh,\n      _props$getUserConfirm = props.getUserConfirmation,\n      getUserConfirmation = _props$getUserConfirm === undefined ? _DOMUtils.getConfirmation : _props$getUserConfirm,\n      _props$keyLength = props.keyLength,\n      keyLength = _props$keyLength === undefined ? 6 : _props$keyLength;\n  var basename = props.basename ? (0, _PathUtils.stripTrailingSlash)((0, _PathUtils.addLeadingSlash)(props.basename)) : '';\n  var getDOMLocation = function getDOMLocation(historyState) {\n    var _ref = historyState || {},\n        key = _ref.key,\n        state = _ref.state;\n    var _window$location = window.location,\n        pathname = _window$location.pathname,\n        search = _window$location.search,\n        hash = _window$location.hash;\n    var path = pathname + search + hash;\n    (0, _warning2.default)(!basename || (0, _PathUtils.hasBasename)(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path \"' + path + '\" to begin with \"' + basename + '\".');\n    if (basename)\n      path = (0, _PathUtils.stripBasename)(path, basename);\n    return (0, _LocationUtils.createLocation)(path, state, key);\n  };\n  var createKey = function createKey() {\n    return Math.random().toString(36).substr(2, keyLength);\n  };\n  var transitionManager = (0, _createTransitionManager2.default)();\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n    history.length = globalHistory.length;\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n  var handlePopState = function handlePopState(event) {\n    if ((0, _DOMUtils.isExtraneousPopstateEvent)(event))\n      return;\n    handlePop(getDOMLocation(event.state));\n  };\n  var handleHashChange = function handleHashChange() {\n    handlePop(getDOMLocation(getHistoryState()));\n  };\n  var forceNextPop = false;\n  var handlePop = function handlePop(location) {\n    if (forceNextPop) {\n      forceNextPop = false;\n      setState();\n    } else {\n      var action = 'POP';\n      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n        if (ok) {\n          setState({\n            action: action,\n            location: location\n          });\n        } else {\n          revertPop(location);\n        }\n      });\n    }\n  };\n  var revertPop = function revertPop(fromLocation) {\n    var toLocation = history.location;\n    var toIndex = allKeys.indexOf(toLocation.key);\n    if (toIndex === -1)\n      toIndex = 0;\n    var fromIndex = allKeys.indexOf(fromLocation.key);\n    if (fromIndex === -1)\n      fromIndex = 0;\n    var delta = toIndex - fromIndex;\n    if (delta) {\n      forceNextPop = true;\n      go(delta);\n    }\n  };\n  var initialLocation = getDOMLocation(getHistoryState());\n  var allKeys = [initialLocation.key];\n  var createHref = function createHref(location) {\n    return basename + (0, _PathUtils.createPath)(location);\n  };\n  var push = function push(path, state) {\n    (0, _warning2.default)(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to push when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n    var action = 'PUSH';\n    var location = (0, _LocationUtils.createLocation)(path, state, createKey(), history.location);\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n      if (!ok)\n        return;\n      var href = createHref(location);\n      var key = location.key,\n          state = location.state;\n      if (canUseHistory) {\n        globalHistory.pushState({\n          key: key,\n          state: state\n        }, null, href);\n        if (forceRefresh) {\n          window.location.href = href;\n        } else {\n          var prevIndex = allKeys.indexOf(history.location.key);\n          var nextKeys = allKeys.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);\n          nextKeys.push(location.key);\n          allKeys = nextKeys;\n          setState({\n            action: action,\n            location: location\n          });\n        }\n      } else {\n        (0, _warning2.default)(state === undefined, 'Browser history cannot push state in browsers that do not support HTML5 history');\n        window.location.href = href;\n      }\n    });\n  };\n  var replace = function replace(path, state) {\n    (0, _warning2.default)(!((typeof path === 'undefined' ? 'undefined' : _typeof(path)) === 'object' && path.state !== undefined && state !== undefined), 'You should avoid providing a 2nd state argument to replace when the 1st ' + 'argument is a location-like object that already has state; it is ignored');\n    var action = 'REPLACE';\n    var location = (0, _LocationUtils.createLocation)(path, state, createKey(), history.location);\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function(ok) {\n      if (!ok)\n        return;\n      var href = createHref(location);\n      var key = location.key,\n          state = location.state;\n      if (canUseHistory) {\n        globalHistory.replaceState({\n          key: key,\n          state: state\n        }, null, href);\n        if (forceRefresh) {\n          window.location.replace(href);\n        } else {\n          var prevIndex = allKeys.indexOf(history.location.key);\n          if (prevIndex !== -1)\n            allKeys[prevIndex] = location.key;\n          setState({\n            action: action,\n            location: location\n          });\n        }\n      } else {\n        (0, _warning2.default)(state === undefined, 'Browser history cannot replace state in browsers that do not support HTML5 history');\n        window.location.replace(href);\n      }\n    });\n  };\n  var go = function go(n) {\n    globalHistory.go(n);\n  };\n  var goBack = function goBack() {\n    return go(-1);\n  };\n  var goForward = function goForward() {\n    return go(1);\n  };\n  var listenerCount = 0;\n  var checkDOMListeners = function checkDOMListeners(delta) {\n    listenerCount += delta;\n    if (listenerCount === 1) {\n      (0, _DOMUtils.addEventListener)(window, PopStateEvent, handlePopState);\n      if (needsHashChangeListener)\n        (0, _DOMUtils.addEventListener)(window, HashChangeEvent, handleHashChange);\n    } else if (listenerCount === 0) {\n      (0, _DOMUtils.removeEventListener)(window, PopStateEvent, handlePopState);\n      if (needsHashChangeListener)\n        (0, _DOMUtils.removeEventListener)(window, HashChangeEvent, handleHashChange);\n    }\n  };\n  var isBlocked = false;\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    var unblock = transitionManager.setPrompt(prompt);\n    if (!isBlocked) {\n      checkDOMListeners(1);\n      isBlocked = true;\n    }\n    return function() {\n      if (isBlocked) {\n        isBlocked = false;\n        checkDOMListeners(-1);\n      }\n      return unblock();\n    };\n  };\n  var listen = function listen(listener) {\n    var unlisten = transitionManager.appendListener(listener);\n    checkDOMListeners(1);\n    return function() {\n      checkDOMListeners(-1);\n      unlisten();\n    };\n  };\n  var history = {\n    length: globalHistory.length,\n    action: 'POP',\n    location: initialLocation,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    block: block,\n    listen: listen\n  };\n  return history;\n};\nexports.default = createBrowserHistory;\n"]}