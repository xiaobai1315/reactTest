{"version":3,"sources":["../../../../../jspm_packages/npm/history@4.7.2/es/createHashHistory.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","HashChangeEvent","HashPathCoders","hashbang","encodePath","path","charAt","decodePath","substr","noslash","slash","getHashPath","href","window","location","hashIndex","indexOf","substring","pushHashPath","hash","replaceHashPath","replace","slice","createHashHistory","props","undefined","globalHistory","history","canGoWithoutReload","_props$getUserConfirm","getUserConfirmation","_props$hashType","hashType","basename","_HashPathCoders$hashT","getDOMLocation","transitionManager","setState","nextState","notifyListeners","action","forceNextPop","ignorePath","handleHashChange","encodedPath","prevLocation","handlePop","confirmTransitionTo","ok","revertPop","fromLocation","toLocation","toIndex","allPaths","lastIndexOf","fromIndex","delta","go","initialLocation","createHref","push","state","hashChanged","prevIndex","nextPaths","n","goBack","goForward","listenerCount","checkDOMListeners","isBlocked","block","prompt","unblock","setPrompt","listen","listener","unlisten","appendListener"],"mappings":";AAAA;AACA;;;;;;AAGA;;;;AACA;;;;AACA;;AACA;;AACA;;;;AACA;;;;AAPA,IAAIA,WAAWC,OAAOC,MAAP,IAAiB,UAAUC,MAAV,EAAkB;AAAE,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIC,UAAUC,MAA9B,EAAsCF,GAAtC,EAA2C;AAAE,QAAIG,SAASF,UAAUD,CAAV,CAAb,CAA2B,KAAK,IAAII,GAAT,IAAgBD,MAAhB,EAAwB;AAAE,UAAIN,OAAOQ,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,MAArC,EAA6CC,GAA7C,CAAJ,EAAuD;AAAEL,eAAOK,GAAP,IAAcD,OAAOC,GAAP,CAAd;AAA4B;AAAE;AAAE,GAAC,OAAOL,MAAP;AAAgB,CAAhQ;;AASA,IAAIS,kBAAkB,YAAtB;;AAEA,IAAIC,iBAAiB;AACnBC,YAAU;AACRC,gBAAY,SAASA,UAAT,CAAoBC,IAApB,EAA0B;AACpC,aAAOA,KAAKC,MAAL,CAAY,CAAZ,MAAmB,GAAnB,GAAyBD,IAAzB,GAAgC,OAAO,kCAAkBA,IAAlB,CAA9C;AACD,KAHO;AAIRE,gBAAY,SAASA,UAAT,CAAoBF,IAApB,EAA0B;AACpC,aAAOA,KAAKC,MAAL,CAAY,CAAZ,MAAmB,GAAnB,GAAyBD,KAAKG,MAAL,CAAY,CAAZ,CAAzB,GAA0CH,IAAjD;AACD;AANO,GADS;AASnBI,WAAS;AACPL,4CADO;AAEPG;AAFO,GATU;AAanBG,SAAO;AACLN,0CADK;AAELG;AAFK;AAbY,CAArB;;AAmBA,IAAII,cAAc,SAASA,WAAT,GAAuB;AACvC;AACA;AACA,MAAIC,OAAOC,OAAOC,QAAP,CAAgBF,IAA3B;AACA,MAAIG,YAAYH,KAAKI,OAAL,CAAa,GAAb,CAAhB;AACA,SAAOD,cAAc,CAAC,CAAf,GAAmB,EAAnB,GAAwBH,KAAKK,SAAL,CAAeF,YAAY,CAA3B,CAA/B;AACD,CAND;;AAQA,IAAIG,eAAe,SAASA,YAAT,CAAsBb,IAAtB,EAA4B;AAC7C,SAAOQ,OAAOC,QAAP,CAAgBK,IAAhB,GAAuBd,IAA9B;AACD,CAFD;;AAIA,IAAIe,kBAAkB,SAASA,eAAT,CAAyBf,IAAzB,EAA+B;AACnD,MAAIU,YAAYF,OAAOC,QAAP,CAAgBF,IAAhB,CAAqBI,OAArB,CAA6B,GAA7B,CAAhB;;AAEAH,SAAOC,QAAP,CAAgBO,OAAhB,CAAwBR,OAAOC,QAAP,CAAgBF,IAAhB,CAAqBU,KAArB,CAA2B,CAA3B,EAA8BP,aAAa,CAAb,GAAiBA,SAAjB,GAA6B,CAA3D,IAAgE,GAAhE,GAAsEV,IAA9F;AACD,CAJD;;AAMA,IAAIkB,oBAAoB,SAASA,iBAAT,GAA6B;AACnD,MAAIC,QAAQ9B,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiB+B,SAAzC,GAAqD/B,UAAU,CAAV,CAArD,GAAoE,EAAhF;;AAEA,gDAAqB,0BAArB;;AAEA,MAAIgC,gBAAgBb,OAAOc,OAA3B;AACA,MAAIC,qBAAqB,iDAAzB;;AAEA,MAAIC,wBAAwBL,MAAMM,mBAAlC;AAAA,MACIA,sBAAsBD,0BAA0BJ,SAA1B,+BAAwDI,qBADlF;AAAA,MAEIE,kBAAkBP,MAAMQ,QAF5B;AAAA,MAGIA,WAAWD,oBAAoBN,SAApB,GAAgC,OAAhC,GAA0CM,eAHzD;;AAKA,MAAIE,WAAWT,MAAMS,QAAN,GAAiB,mCAAmB,gCAAgBT,MAAMS,QAAtB,CAAnB,CAAjB,GAAuE,EAAtF;;AAEA,MAAIC,wBAAwBhC,eAAe8B,QAAf,CAA5B;AAAA,MACI5B,aAAa8B,sBAAsB9B,UADvC;AAAA,MAEIG,aAAa2B,sBAAsB3B,UAFvC;;AAKA,MAAI4B,iBAAiB,SAASA,cAAT,GAA0B;AAC7C,QAAI9B,OAAOE,WAAWI,aAAX,CAAX;;AAEA,2BAAQ,CAACsB,QAAD,IAAa,4BAAY5B,IAAZ,EAAkB4B,QAAlB,CAArB,EAAkD,kFAAkF,oCAAlF,GAAyH5B,IAAzH,GAAgI,mBAAhI,GAAsJ4B,QAAtJ,GAAiK,IAAnN;;AAEA,QAAIA,QAAJ,EAAc5B,OAAO,8BAAcA,IAAd,EAAoB4B,QAApB,CAAP;;AAEd,WAAO,mCAAe5B,IAAf,CAAP;AACD,GARD;;AAUA,MAAI+B,oBAAoB,wCAAxB;;AAEA,MAAIC,WAAW,SAASA,QAAT,CAAkBC,SAAlB,EAA6B;AAC1CjD,aAASsC,OAAT,EAAkBW,SAAlB;;AAEAX,YAAQhC,MAAR,GAAiB+B,cAAc/B,MAA/B;;AAEAyC,sBAAkBG,eAAlB,CAAkCZ,QAAQb,QAA1C,EAAoDa,QAAQa,MAA5D;AACD,GAND;;AAQA,MAAIC,eAAe,KAAnB;AACA,MAAIC,aAAa,IAAjB;;AAEA,MAAIC,mBAAmB,SAASA,gBAAT,GAA4B;AACjD,QAAItC,OAAOM,aAAX;AACA,QAAIiC,cAAcxC,WAAWC,IAAX,CAAlB;;AAEA,QAAIA,SAASuC,WAAb,EAA0B;AACxB;AACAxB,sBAAgBwB,WAAhB;AACD,KAHD,MAGO;AACL,UAAI9B,WAAWqB,gBAAf;AACA,UAAIU,eAAelB,QAAQb,QAA3B;;AAEA,UAAI,CAAC2B,YAAD,IAAiB,sCAAkBI,YAAlB,EAAgC/B,QAAhC,CAArB,EAAgE,OAJ3D,CAImE;;AAExE,UAAI4B,eAAe,2BAAW5B,QAAX,CAAnB,EAAyC,OANpC,CAM4C;;AAEjD4B,mBAAa,IAAb;;AAEAI,gBAAUhC,QAAV;AACD;AACF,GAnBD;;AAqBA,MAAIgC,YAAY,SAASA,SAAT,CAAmBhC,QAAnB,EAA6B;AAC3C,QAAI2B,YAAJ,EAAkB;AAChBA,qBAAe,KAAf;AACAJ;AACD,KAHD,MAGO;AACL,UAAIG,SAAS,KAAb;;AAEAJ,wBAAkBW,mBAAlB,CAAsCjC,QAAtC,EAAgD0B,MAAhD,EAAwDV,mBAAxD,EAA6E,UAAUkB,EAAV,EAAc;AACzF,YAAIA,EAAJ,EAAQ;AACNX,mBAAS,EAAEG,QAAQA,MAAV,EAAkB1B,UAAUA,QAA5B,EAAT;AACD,SAFD,MAEO;AACLmC,oBAAUnC,QAAV;AACD;AACF,OAND;AAOD;AACF,GAfD;;AAiBA,MAAImC,YAAY,SAASA,SAAT,CAAmBC,YAAnB,EAAiC;AAC/C,QAAIC,aAAaxB,QAAQb,QAAzB;;AAEA;AACA;AACA;;AAEA,QAAIsC,UAAUC,SAASC,WAAT,CAAqB,2BAAWH,UAAX,CAArB,CAAd;;AAEA,QAAIC,YAAY,CAAC,CAAjB,EAAoBA,UAAU,CAAV;;AAEpB,QAAIG,YAAYF,SAASC,WAAT,CAAqB,2BAAWJ,YAAX,CAArB,CAAhB;;AAEA,QAAIK,cAAc,CAAC,CAAnB,EAAsBA,YAAY,CAAZ;;AAEtB,QAAIC,QAAQJ,UAAUG,SAAtB;;AAEA,QAAIC,KAAJ,EAAW;AACTf,qBAAe,IAAf;AACAgB,SAAGD,KAAH;AACD;AACF,GArBD;;AAuBA;AACA,MAAInD,OAAOM,aAAX;AACA,MAAIiC,cAAcxC,WAAWC,IAAX,CAAlB;;AAEA,MAAIA,SAASuC,WAAb,EAA0BxB,gBAAgBwB,WAAhB;;AAE1B,MAAIc,kBAAkBvB,gBAAtB;AACA,MAAIkB,WAAW,CAAC,2BAAWK,eAAX,CAAD,CAAf;;AAEA;;AAEA,MAAIC,aAAa,SAASA,UAAT,CAAoB7C,QAApB,EAA8B;AAC7C,WAAO,MAAMV,WAAW6B,WAAW,2BAAWnB,QAAX,CAAtB,CAAb;AACD,GAFD;;AAIA,MAAI8C,OAAO,SAASA,IAAT,CAAcvD,IAAd,EAAoBwD,KAApB,EAA2B;AACpC,2BAAQA,UAAUpC,SAAlB,EAA6B,+CAA7B;;AAEA,QAAIe,SAAS,MAAb;AACA,QAAI1B,WAAW,mCAAeT,IAAf,EAAqBoB,SAArB,EAAgCA,SAAhC,EAA2CE,QAAQb,QAAnD,CAAf;;AAEAsB,sBAAkBW,mBAAlB,CAAsCjC,QAAtC,EAAgD0B,MAAhD,EAAwDV,mBAAxD,EAA6E,UAAUkB,EAAV,EAAc;AACzF,UAAI,CAACA,EAAL,EAAS;;AAET,UAAI3C,OAAO,2BAAWS,QAAX,CAAX;AACA,UAAI8B,cAAcxC,WAAW6B,WAAW5B,IAAtB,CAAlB;AACA,UAAIyD,cAAcnD,kBAAkBiC,WAApC;;AAEA,UAAIkB,WAAJ,EAAiB;AACf;AACA;AACA;AACApB,qBAAarC,IAAb;AACAa,qBAAa0B,WAAb;;AAEA,YAAImB,YAAYV,SAASC,WAAT,CAAqB,2BAAW3B,QAAQb,QAAnB,CAArB,CAAhB;AACA,YAAIkD,YAAYX,SAAS/B,KAAT,CAAe,CAAf,EAAkByC,cAAc,CAAC,CAAf,GAAmB,CAAnB,GAAuBA,YAAY,CAArD,CAAhB;;AAEAC,kBAAUJ,IAAV,CAAevD,IAAf;AACAgD,mBAAWW,SAAX;;AAEA3B,iBAAS,EAAEG,QAAQA,MAAV,EAAkB1B,UAAUA,QAA5B,EAAT;AACD,OAdD,MAcO;AACL,+BAAQ,KAAR,EAAe,4FAAf;;AAEAuB;AACD;AACF,KA1BD;AA2BD,GAjCD;;AAmCA,MAAIhB,UAAU,SAASA,OAAT,CAAiBhB,IAAjB,EAAuBwD,KAAvB,EAA8B;AAC1C,2BAAQA,UAAUpC,SAAlB,EAA6B,kDAA7B;;AAEA,QAAIe,SAAS,SAAb;AACA,QAAI1B,WAAW,mCAAeT,IAAf,EAAqBoB,SAArB,EAAgCA,SAAhC,EAA2CE,QAAQb,QAAnD,CAAf;;AAEAsB,sBAAkBW,mBAAlB,CAAsCjC,QAAtC,EAAgD0B,MAAhD,EAAwDV,mBAAxD,EAA6E,UAAUkB,EAAV,EAAc;AACzF,UAAI,CAACA,EAAL,EAAS;;AAET,UAAI3C,OAAO,2BAAWS,QAAX,CAAX;AACA,UAAI8B,cAAcxC,WAAW6B,WAAW5B,IAAtB,CAAlB;AACA,UAAIyD,cAAcnD,kBAAkBiC,WAApC;;AAEA,UAAIkB,WAAJ,EAAiB;AACf;AACA;AACA;AACApB,qBAAarC,IAAb;AACAe,wBAAgBwB,WAAhB;AACD;;AAED,UAAImB,YAAYV,SAASrC,OAAT,CAAiB,2BAAWW,QAAQb,QAAnB,CAAjB,CAAhB;;AAEA,UAAIiD,cAAc,CAAC,CAAnB,EAAsBV,SAASU,SAAT,IAAsB1D,IAAtB;;AAEtBgC,eAAS,EAAEG,QAAQA,MAAV,EAAkB1B,UAAUA,QAA5B,EAAT;AACD,KApBD;AAqBD,GA3BD;;AA6BA,MAAI2C,KAAK,SAASA,EAAT,CAAYQ,CAAZ,EAAe;AACtB,2BAAQrC,kBAAR,EAA4B,8DAA5B;;AAEAF,kBAAc+B,EAAd,CAAiBQ,CAAjB;AACD,GAJD;;AAMA,MAAIC,SAAS,SAASA,MAAT,GAAkB;AAC7B,WAAOT,GAAG,CAAC,CAAJ,CAAP;AACD,GAFD;;AAIA,MAAIU,YAAY,SAASA,SAAT,GAAqB;AACnC,WAAOV,GAAG,CAAH,CAAP;AACD,GAFD;;AAIA,MAAIW,gBAAgB,CAApB;;AAEA,MAAIC,oBAAoB,SAASA,iBAAT,CAA2Bb,KAA3B,EAAkC;AACxDY,qBAAiBZ,KAAjB;;AAEA,QAAIY,kBAAkB,CAAtB,EAAyB;AACvB,sCAAiBvD,MAAjB,EAAyBZ,eAAzB,EAA0C0C,gBAA1C;AACD,KAFD,MAEO,IAAIyB,kBAAkB,CAAtB,EAAyB;AAC9B,yCAAoBvD,MAApB,EAA4BZ,eAA5B,EAA6C0C,gBAA7C;AACD;AACF,GARD;;AAUA,MAAI2B,YAAY,KAAhB;;AAEA,MAAIC,QAAQ,SAASA,KAAT,GAAiB;AAC3B,QAAIC,SAAS9E,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiB+B,SAAzC,GAAqD/B,UAAU,CAAV,CAArD,GAAoE,KAAjF;;AAEA,QAAI+E,UAAUrC,kBAAkBsC,SAAlB,CAA4BF,MAA5B,CAAd;;AAEA,QAAI,CAACF,SAAL,EAAgB;AACdD,wBAAkB,CAAlB;AACAC,kBAAY,IAAZ;AACD;;AAED,WAAO,YAAY;AACjB,UAAIA,SAAJ,EAAe;AACbA,oBAAY,KAAZ;AACAD,0BAAkB,CAAC,CAAnB;AACD;;AAED,aAAOI,SAAP;AACD,KAPD;AAQD,GAlBD;;AAoBA,MAAIE,SAAS,SAASA,MAAT,CAAgBC,QAAhB,EAA0B;AACrC,QAAIC,WAAWzC,kBAAkB0C,cAAlB,CAAiCF,QAAjC,CAAf;AACAP,sBAAkB,CAAlB;;AAEA,WAAO,YAAY;AACjBA,wBAAkB,CAAC,CAAnB;AACAQ;AACD,KAHD;AAID,GARD;;AAUA,MAAIlD,UAAU;AACZhC,YAAQ+B,cAAc/B,MADV;AAEZ6C,YAAQ,KAFI;AAGZ1B,cAAU4C,eAHE;AAIZC,gBAAYA,UAJA;AAKZC,UAAMA,IALM;AAMZvC,aAASA,OANG;AAOZoC,QAAIA,EAPQ;AAQZS,YAAQA,MARI;AASZC,eAAWA,SATC;AAUZI,WAAOA,KAVK;AAWZI,YAAQA;AAXI,GAAd;;AAcA,SAAOhD,OAAP;AACD,CAhQD;;kBAkQeJ,iB","file":"createHashHistory.js","sourcesContent":["/* */ \n\"format cjs\";\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nimport warning from 'warning';\nimport invariant from 'invariant';\nimport { createLocation, locationsAreEqual } from './LocationUtils';\nimport { addLeadingSlash, stripLeadingSlash, stripTrailingSlash, hasBasename, stripBasename, createPath } from './PathUtils';\nimport createTransitionManager from './createTransitionManager';\nimport { canUseDOM, addEventListener, removeEventListener, getConfirmation, supportsGoWithoutReloadUsingHash } from './DOMUtils';\n\nvar HashChangeEvent = 'hashchange';\n\nvar HashPathCoders = {\n  hashbang: {\n    encodePath: function encodePath(path) {\n      return path.charAt(0) === '!' ? path : '!/' + stripLeadingSlash(path);\n    },\n    decodePath: function decodePath(path) {\n      return path.charAt(0) === '!' ? path.substr(1) : path;\n    }\n  },\n  noslash: {\n    encodePath: stripLeadingSlash,\n    decodePath: addLeadingSlash\n  },\n  slash: {\n    encodePath: addLeadingSlash,\n    decodePath: addLeadingSlash\n  }\n};\n\nvar getHashPath = function getHashPath() {\n  // We can't use window.location.hash here because it's not\n  // consistent across browsers - Firefox will pre-decode it!\n  var href = window.location.href;\n  var hashIndex = href.indexOf('#');\n  return hashIndex === -1 ? '' : href.substring(hashIndex + 1);\n};\n\nvar pushHashPath = function pushHashPath(path) {\n  return window.location.hash = path;\n};\n\nvar replaceHashPath = function replaceHashPath(path) {\n  var hashIndex = window.location.href.indexOf('#');\n\n  window.location.replace(window.location.href.slice(0, hashIndex >= 0 ? hashIndex : 0) + '#' + path);\n};\n\nvar createHashHistory = function createHashHistory() {\n  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  invariant(canUseDOM, 'Hash history needs a DOM');\n\n  var globalHistory = window.history;\n  var canGoWithoutReload = supportsGoWithoutReloadUsingHash();\n\n  var _props$getUserConfirm = props.getUserConfirmation,\n      getUserConfirmation = _props$getUserConfirm === undefined ? getConfirmation : _props$getUserConfirm,\n      _props$hashType = props.hashType,\n      hashType = _props$hashType === undefined ? 'slash' : _props$hashType;\n\n  var basename = props.basename ? stripTrailingSlash(addLeadingSlash(props.basename)) : '';\n\n  var _HashPathCoders$hashT = HashPathCoders[hashType],\n      encodePath = _HashPathCoders$hashT.encodePath,\n      decodePath = _HashPathCoders$hashT.decodePath;\n\n\n  var getDOMLocation = function getDOMLocation() {\n    var path = decodePath(getHashPath());\n\n    warning(!basename || hasBasename(path, basename), 'You are attempting to use a basename on a page whose URL path does not begin ' + 'with the basename. Expected path \"' + path + '\" to begin with \"' + basename + '\".');\n\n    if (basename) path = stripBasename(path, basename);\n\n    return createLocation(path);\n  };\n\n  var transitionManager = createTransitionManager();\n\n  var setState = function setState(nextState) {\n    _extends(history, nextState);\n\n    history.length = globalHistory.length;\n\n    transitionManager.notifyListeners(history.location, history.action);\n  };\n\n  var forceNextPop = false;\n  var ignorePath = null;\n\n  var handleHashChange = function handleHashChange() {\n    var path = getHashPath();\n    var encodedPath = encodePath(path);\n\n    if (path !== encodedPath) {\n      // Ensure we always have a properly-encoded hash.\n      replaceHashPath(encodedPath);\n    } else {\n      var location = getDOMLocation();\n      var prevLocation = history.location;\n\n      if (!forceNextPop && locationsAreEqual(prevLocation, location)) return; // A hashchange doesn't always == location change.\n\n      if (ignorePath === createPath(location)) return; // Ignore this change; we already setState in push/replace.\n\n      ignorePath = null;\n\n      handlePop(location);\n    }\n  };\n\n  var handlePop = function handlePop(location) {\n    if (forceNextPop) {\n      forceNextPop = false;\n      setState();\n    } else {\n      var action = 'POP';\n\n      transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n        if (ok) {\n          setState({ action: action, location: location });\n        } else {\n          revertPop(location);\n        }\n      });\n    }\n  };\n\n  var revertPop = function revertPop(fromLocation) {\n    var toLocation = history.location;\n\n    // TODO: We could probably make this more reliable by\n    // keeping a list of paths we've seen in sessionStorage.\n    // Instead, we just default to 0 for paths we don't know.\n\n    var toIndex = allPaths.lastIndexOf(createPath(toLocation));\n\n    if (toIndex === -1) toIndex = 0;\n\n    var fromIndex = allPaths.lastIndexOf(createPath(fromLocation));\n\n    if (fromIndex === -1) fromIndex = 0;\n\n    var delta = toIndex - fromIndex;\n\n    if (delta) {\n      forceNextPop = true;\n      go(delta);\n    }\n  };\n\n  // Ensure the hash is encoded properly before doing anything else.\n  var path = getHashPath();\n  var encodedPath = encodePath(path);\n\n  if (path !== encodedPath) replaceHashPath(encodedPath);\n\n  var initialLocation = getDOMLocation();\n  var allPaths = [createPath(initialLocation)];\n\n  // Public interface\n\n  var createHref = function createHref(location) {\n    return '#' + encodePath(basename + createPath(location));\n  };\n\n  var push = function push(path, state) {\n    warning(state === undefined, 'Hash history cannot push state; it is ignored');\n\n    var action = 'PUSH';\n    var location = createLocation(path, undefined, undefined, history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var path = createPath(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n\n      if (hashChanged) {\n        // We cannot tell if a hashchange was caused by a PUSH, so we'd\n        // rather setState here and ignore the hashchange. The caveat here\n        // is that other hash histories in the page will consider it a POP.\n        ignorePath = path;\n        pushHashPath(encodedPath);\n\n        var prevIndex = allPaths.lastIndexOf(createPath(history.location));\n        var nextPaths = allPaths.slice(0, prevIndex === -1 ? 0 : prevIndex + 1);\n\n        nextPaths.push(path);\n        allPaths = nextPaths;\n\n        setState({ action: action, location: location });\n      } else {\n        warning(false, 'Hash history cannot PUSH the same path; a new entry will not be added to the history stack');\n\n        setState();\n      }\n    });\n  };\n\n  var replace = function replace(path, state) {\n    warning(state === undefined, 'Hash history cannot replace state; it is ignored');\n\n    var action = 'REPLACE';\n    var location = createLocation(path, undefined, undefined, history.location);\n\n    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, function (ok) {\n      if (!ok) return;\n\n      var path = createPath(location);\n      var encodedPath = encodePath(basename + path);\n      var hashChanged = getHashPath() !== encodedPath;\n\n      if (hashChanged) {\n        // We cannot tell if a hashchange was caused by a REPLACE, so we'd\n        // rather setState here and ignore the hashchange. The caveat here\n        // is that other hash histories in the page will consider it a POP.\n        ignorePath = path;\n        replaceHashPath(encodedPath);\n      }\n\n      var prevIndex = allPaths.indexOf(createPath(history.location));\n\n      if (prevIndex !== -1) allPaths[prevIndex] = path;\n\n      setState({ action: action, location: location });\n    });\n  };\n\n  var go = function go(n) {\n    warning(canGoWithoutReload, 'Hash history go(n) causes a full page reload in this browser');\n\n    globalHistory.go(n);\n  };\n\n  var goBack = function goBack() {\n    return go(-1);\n  };\n\n  var goForward = function goForward() {\n    return go(1);\n  };\n\n  var listenerCount = 0;\n\n  var checkDOMListeners = function checkDOMListeners(delta) {\n    listenerCount += delta;\n\n    if (listenerCount === 1) {\n      addEventListener(window, HashChangeEvent, handleHashChange);\n    } else if (listenerCount === 0) {\n      removeEventListener(window, HashChangeEvent, handleHashChange);\n    }\n  };\n\n  var isBlocked = false;\n\n  var block = function block() {\n    var prompt = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n    var unblock = transitionManager.setPrompt(prompt);\n\n    if (!isBlocked) {\n      checkDOMListeners(1);\n      isBlocked = true;\n    }\n\n    return function () {\n      if (isBlocked) {\n        isBlocked = false;\n        checkDOMListeners(-1);\n      }\n\n      return unblock();\n    };\n  };\n\n  var listen = function listen(listener) {\n    var unlisten = transitionManager.appendListener(listener);\n    checkDOMListeners(1);\n\n    return function () {\n      checkDOMListeners(-1);\n      unlisten();\n    };\n  };\n\n  var history = {\n    length: globalHistory.length,\n    action: 'POP',\n    location: initialLocation,\n    createHref: createHref,\n    push: push,\n    replace: replace,\n    go: go,\n    goBack: goBack,\n    goForward: goForward,\n    block: block,\n    listen: listen\n  };\n\n  return history;\n};\n\nexport default createHashHistory;"]}