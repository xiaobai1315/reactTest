{"version":3,"sources":["../../../../jspm_packages/npm/process@0.11.10/test.js"],"names":["assert","require","ourProcess","describe","test","process","browser","vmtest","it","done","order","nextTick","num","equal","t","removeAllListeners","once","err","Error","oldTimeout","setTimeout","oldClear","clearTimeout","ok","ran","cleanup","e","vm","fs","readFileSync","encoding","str","script","Script","context","works","runInNewContext","hiddenSetTimeout","hiddenClearTimeout"],"mappings":"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","file":"test.js","sourcesContent":["/* */ \nvar assert = require('assert');\nvar ourProcess = require('./browser');\ndescribe('test against our process', function() {\n  test(ourProcess);\n});\nif (!process.browser) {\n  describe('test against node', function() {\n    test(process);\n  });\n  vmtest();\n}\nfunction test(ourProcess) {\n  describe('test arguments', function() {\n    it('works', function(done) {\n      var order = 0;\n      ourProcess.nextTick(function(num) {\n        assert.equal(num, order++, 'first one works');\n        ourProcess.nextTick(function(num) {\n          assert.equal(num, order++, 'recursive one is 4th');\n        }, 3);\n      }, 0);\n      ourProcess.nextTick(function(num) {\n        assert.equal(num, order++, 'second one starts');\n        ourProcess.nextTick(function(num) {\n          assert.equal(num, order++, 'this is third');\n          ourProcess.nextTick(function(num) {\n            assert.equal(num, order++, 'this is last');\n            done();\n          }, 5);\n        }, 4);\n      }, 1);\n      ourProcess.nextTick(function(num) {\n        assert.equal(num, order++, '3rd schedualed happens after the error');\n      }, 2);\n    });\n  });\n  if (!process.browser) {\n    describe('test errors', function(t) {\n      it('works', function(done) {\n        var order = 0;\n        process.removeAllListeners('uncaughtException');\n        process.once('uncaughtException', function(err) {\n          assert.equal(2, order++, 'error is third');\n          ourProcess.nextTick(function() {\n            assert.equal(5, order++, 'schedualed in error is last');\n            done();\n          });\n        });\n        ourProcess.nextTick(function() {\n          assert.equal(0, order++, 'first one works');\n          ourProcess.nextTick(function() {\n            assert.equal(4, order++, 'recursive one is 4th');\n          });\n        });\n        ourProcess.nextTick(function() {\n          assert.equal(1, order++, 'second one starts');\n          throw (new Error('an error is thrown'));\n        });\n        ourProcess.nextTick(function() {\n          assert.equal(3, order++, '3rd schedualed happens after the error');\n        });\n      });\n    });\n  }\n  describe('rename globals', function(t) {\n    var oldTimeout = setTimeout;\n    var oldClear = clearTimeout;\n    it('clearTimeout', function(done) {\n      var ok = true;\n      clearTimeout = function() {\n        ok = false;\n      };\n      var ran = false;\n      function cleanup() {\n        clearTimeout = oldClear;\n        var err;\n        try {\n          assert.ok(ok, 'fake clearTimeout ran');\n          assert.ok(ran, 'should have run');\n        } catch (e) {\n          err = e;\n        }\n        done(err);\n      }\n      setTimeout(cleanup, 1000);\n      ourProcess.nextTick(function() {\n        ran = true;\n      });\n    });\n    it('just setTimeout', function(done) {\n      setTimeout = function() {\n        setTimeout = oldTimeout;\n        try {\n          assert.ok(false, 'fake setTimeout called');\n        } catch (e) {\n          done(e);\n        }\n      };\n      ourProcess.nextTick(function() {\n        setTimeout = oldTimeout;\n        done();\n      });\n    });\n  });\n}\nfunction vmtest() {\n  var vm = require('vm');\n  var fs = require('fs');\n  var process = fs.readFileSync('./browser.js', {encoding: 'utf8'});\n  describe('should work in vm in strict mode with no globals', function() {\n    it('should parse', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'this.works = process.browser;';\n      var script = new vm.Script(str);\n      var context = {works: false};\n      script.runInNewContext(context);\n      assert.ok(context.works);\n      done();\n    });\n    it('setTimeout throws error', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'try {process.nextTick(function () {})} catch (e){this.works = e;}';\n      var script = new vm.Script(str);\n      var context = {works: false};\n      script.runInNewContext(context);\n      assert.ok(context.works);\n      done();\n    });\n    it('should generally work', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'process.nextTick(function () {assert.ok(true);done();})';\n      var script = new vm.Script(str);\n      var context = {\n        clearTimeout: clearTimeout,\n        setTimeout: setTimeout,\n        done: done,\n        assert: assert\n      };\n      script.runInNewContext(context);\n    });\n    it('late defs setTimeout', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'var setTimeout = hiddenSetTimeout;process.nextTick(function () {assert.ok(true);done();})';\n      var script = new vm.Script(str);\n      var context = {\n        clearTimeout: clearTimeout,\n        hiddenSetTimeout: setTimeout,\n        done: done,\n        assert: assert\n      };\n      script.runInNewContext(context);\n    });\n    it('late defs clearTimeout', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'var clearTimeout = hiddenClearTimeout;process.nextTick(function () {assert.ok(true);done();})';\n      var script = new vm.Script(str);\n      var context = {\n        hiddenClearTimeout: clearTimeout,\n        setTimeout: setTimeout,\n        done: done,\n        assert: assert\n      };\n      script.runInNewContext(context);\n    });\n    it('late defs setTimeout and then redefine', function(done) {\n      var str = '\"use strict\";var module = {exports:{}};';\n      str += process;\n      str += 'var setTimeout = hiddenSetTimeout;process.nextTick(function () {setTimeout = function (){throw new Error(\"foo\")};hiddenSetTimeout(function(){process.nextTick(function (){assert.ok(true);done();});});});';\n      var script = new vm.Script(str);\n      var context = {\n        clearTimeout: clearTimeout,\n        hiddenSetTimeout: setTimeout,\n        done: done,\n        assert: assert\n      };\n      script.runInNewContext(context);\n    });\n  });\n}\n"]}