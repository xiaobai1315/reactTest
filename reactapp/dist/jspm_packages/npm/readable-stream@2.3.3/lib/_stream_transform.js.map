{"version":3,"sources":["../../../../../jspm_packages/npm/readable-stream@2.3.3/lib/_stream_transform.js"],"names":["process","module","exports","Transform","Duplex","require","util","inherits","TransformState","stream","afterTransform","er","data","needTransform","transforming","writecb","writechunk","writeencoding","ts","_transformState","cb","emit","Error","undefined","push","rs","_readableState","reading","needReadable","length","highWaterMark","_read","options","call","sync","transform","_transform","flush","_flush","once","done","prototype","chunk","encoding","_write","n","_destroy","err","_this","err2","ws","_writableState"],"mappings":"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","file":"_stream_transform.js","sourcesContent":["/* */ \n(function(process) {\n  'use strict';\n  module.exports = Transform;\n  var Duplex = require('./_stream_duplex');\n  var util = require('core-util-is');\n  util.inherits = require('inherits');\n  util.inherits(Transform, Duplex);\n  function TransformState(stream) {\n    this.afterTransform = function(er, data) {\n      return afterTransform(stream, er, data);\n    };\n    this.needTransform = false;\n    this.transforming = false;\n    this.writecb = null;\n    this.writechunk = null;\n    this.writeencoding = null;\n  }\n  function afterTransform(stream, er, data) {\n    var ts = stream._transformState;\n    ts.transforming = false;\n    var cb = ts.writecb;\n    if (!cb) {\n      return stream.emit('error', new Error('write callback called multiple times'));\n    }\n    ts.writechunk = null;\n    ts.writecb = null;\n    if (data !== null && data !== undefined)\n      stream.push(data);\n    cb(er);\n    var rs = stream._readableState;\n    rs.reading = false;\n    if (rs.needReadable || rs.length < rs.highWaterMark) {\n      stream._read(rs.highWaterMark);\n    }\n  }\n  function Transform(options) {\n    if (!(this instanceof Transform))\n      return new Transform(options);\n    Duplex.call(this, options);\n    this._transformState = new TransformState(this);\n    var stream = this;\n    this._readableState.needReadable = true;\n    this._readableState.sync = false;\n    if (options) {\n      if (typeof options.transform === 'function')\n        this._transform = options.transform;\n      if (typeof options.flush === 'function')\n        this._flush = options.flush;\n    }\n    this.once('prefinish', function() {\n      if (typeof this._flush === 'function')\n        this._flush(function(er, data) {\n          done(stream, er, data);\n        });\n      else\n        done(stream);\n    });\n  }\n  Transform.prototype.push = function(chunk, encoding) {\n    this._transformState.needTransform = false;\n    return Duplex.prototype.push.call(this, chunk, encoding);\n  };\n  Transform.prototype._transform = function(chunk, encoding, cb) {\n    throw new Error('_transform() is not implemented');\n  };\n  Transform.prototype._write = function(chunk, encoding, cb) {\n    var ts = this._transformState;\n    ts.writecb = cb;\n    ts.writechunk = chunk;\n    ts.writeencoding = encoding;\n    if (!ts.transforming) {\n      var rs = this._readableState;\n      if (ts.needTransform || rs.needReadable || rs.length < rs.highWaterMark)\n        this._read(rs.highWaterMark);\n    }\n  };\n  Transform.prototype._read = function(n) {\n    var ts = this._transformState;\n    if (ts.writechunk !== null && ts.writecb && !ts.transforming) {\n      ts.transforming = true;\n      this._transform(ts.writechunk, ts.writeencoding, ts.afterTransform);\n    } else {\n      ts.needTransform = true;\n    }\n  };\n  Transform.prototype._destroy = function(err, cb) {\n    var _this = this;\n    Duplex.prototype._destroy.call(this, err, function(err2) {\n      cb(err2);\n      _this.emit('close');\n    });\n  };\n  function done(stream, er, data) {\n    if (er)\n      return stream.emit('error', er);\n    if (data !== null && data !== undefined)\n      stream.push(data);\n    var ws = stream._writableState;\n    var ts = stream._transformState;\n    if (ws.length)\n      throw new Error('Calling transform done when ws.length != 0');\n    if (ts.transforming)\n      throw new Error('Calling transform done when still transforming');\n    return stream.push(null);\n  }\n})(require('process'));\n"]}