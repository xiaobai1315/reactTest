{"version":3,"sources":["../../../../jspm_packages/npm/node-fetch@1.7.3/index.js"],"names":["Buffer","parse_url","require","parse","resolve_url","resolve","http","https","zlib","stream","Body","Response","Headers","Request","FetchError","module","exports","Fetch","default","url","opts","Promise","Error","self","reject","options","protocol","hostname","send","request","headers","compress","set","has","agent","body","getBoundary","test","method","byteLength","getLengthSync","_lengthRetrievers","length","toString","hasKnownLength","undefined","raw","host","req","reqTimeout","timeout","once","socket","setTimeout","abort","on","err","clearTimeout","message","res","isRedirect","statusCode","redirect","counter","follow","location","get","pipe","PassThrough","response_options","status","statusText","statusMessage","size","output","name","createGunzip","chunk","createInflate","createInflateRaw","write","end","prototype","code","global"],"mappings":"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","file":"index.js","sourcesContent":["/* */ \n(function(Buffer) {\n  var parse_url = require('url').parse;\n  var resolve_url = require('url').resolve;\n  var http = require('http');\n  var https = require('https');\n  var zlib = require('zlib');\n  var stream = require('stream');\n  var Body = require('./lib/body');\n  var Response = require('./lib/response');\n  var Headers = require('./lib/headers');\n  var Request = require('./lib/request');\n  var FetchError = require('./lib/fetch-error');\n  module.exports = Fetch;\n  module.exports.default = module.exports;\n  function Fetch(url, opts) {\n    if (!(this instanceof Fetch))\n      return new Fetch(url, opts);\n    if (!Fetch.Promise) {\n      throw new Error('native promise missing, set Fetch.Promise to your favorite alternative');\n    }\n    Body.Promise = Fetch.Promise;\n    var self = this;\n    return new Fetch.Promise(function(resolve, reject) {\n      var options = new Request(url, opts);\n      if (!options.protocol || !options.hostname) {\n        throw new Error('only absolute urls are supported');\n      }\n      if (options.protocol !== 'http:' && options.protocol !== 'https:') {\n        throw new Error('only http(s) protocols are supported');\n      }\n      var send;\n      if (options.protocol === 'https:') {\n        send = https.request;\n      } else {\n        send = http.request;\n      }\n      var headers = new Headers(options.headers);\n      if (options.compress) {\n        headers.set('accept-encoding', 'gzip,deflate');\n      }\n      if (!headers.has('user-agent')) {\n        headers.set('user-agent', 'node-fetch/1.0 (+https://github.com/bitinn/node-fetch)');\n      }\n      if (!headers.has('connection') && !options.agent) {\n        headers.set('connection', 'close');\n      }\n      if (!headers.has('accept')) {\n        headers.set('accept', '*/*');\n      }\n      if (!headers.has('content-type') && options.body && typeof options.body.getBoundary === 'function') {\n        headers.set('content-type', 'multipart/form-data; boundary=' + options.body.getBoundary());\n      }\n      if (!headers.has('content-length') && /post|put|patch|delete/i.test(options.method)) {\n        if (typeof options.body === 'string') {\n          headers.set('content-length', Buffer.byteLength(options.body));\n        } else if (options.body && typeof options.body.getLengthSync === 'function') {\n          if (options.body._lengthRetrievers && options.body._lengthRetrievers.length == 0) {\n            headers.set('content-length', options.body.getLengthSync().toString());\n          } else if (options.body.hasKnownLength && options.body.hasKnownLength()) {\n            headers.set('content-length', options.body.getLengthSync().toString());\n          }\n        } else if (options.body === undefined || options.body === null) {\n          headers.set('content-length', '0');\n        }\n      }\n      options.headers = headers.raw();\n      if (options.headers.host) {\n        options.headers.host = options.headers.host[0];\n      }\n      var req = send(options);\n      var reqTimeout;\n      if (options.timeout) {\n        req.once('socket', function(socket) {\n          reqTimeout = setTimeout(function() {\n            req.abort();\n            reject(new FetchError('network timeout at: ' + options.url, 'request-timeout'));\n          }, options.timeout);\n        });\n      }\n      req.on('error', function(err) {\n        clearTimeout(reqTimeout);\n        reject(new FetchError('request to ' + options.url + ' failed, reason: ' + err.message, 'system', err));\n      });\n      req.on('response', function(res) {\n        clearTimeout(reqTimeout);\n        if (self.isRedirect(res.statusCode) && options.redirect !== 'manual') {\n          if (options.redirect === 'error') {\n            reject(new FetchError('redirect mode is set to error: ' + options.url, 'no-redirect'));\n            return;\n          }\n          if (options.counter >= options.follow) {\n            reject(new FetchError('maximum redirect reached at: ' + options.url, 'max-redirect'));\n            return;\n          }\n          if (!res.headers.location) {\n            reject(new FetchError('redirect location header missing at: ' + options.url, 'invalid-redirect'));\n            return;\n          }\n          if (res.statusCode === 303 || ((res.statusCode === 301 || res.statusCode === 302) && options.method === 'POST')) {\n            options.method = 'GET';\n            delete options.body;\n            delete options.headers['content-length'];\n          }\n          options.counter++;\n          resolve(Fetch(resolve_url(options.url, res.headers.location), options));\n          return;\n        }\n        var headers = new Headers(res.headers);\n        if (options.redirect === 'manual' && headers.has('location')) {\n          headers.set('location', resolve_url(options.url, headers.get('location')));\n        }\n        var body = res.pipe(new stream.PassThrough());\n        var response_options = {\n          url: options.url,\n          status: res.statusCode,\n          statusText: res.statusMessage,\n          headers: headers,\n          size: options.size,\n          timeout: options.timeout\n        };\n        var output;\n        if (!options.compress || options.method === 'HEAD' || !headers.has('content-encoding') || res.statusCode === 204 || res.statusCode === 304) {\n          output = new Response(body, response_options);\n          resolve(output);\n          return;\n        }\n        var name = headers.get('content-encoding');\n        if (name == 'gzip' || name == 'x-gzip') {\n          body = body.pipe(zlib.createGunzip());\n          output = new Response(body, response_options);\n          resolve(output);\n          return;\n        } else if (name == 'deflate' || name == 'x-deflate') {\n          var raw = res.pipe(new stream.PassThrough());\n          raw.once('data', function(chunk) {\n            if ((chunk[0] & 0x0F) === 0x08) {\n              body = body.pipe(zlib.createInflate());\n            } else {\n              body = body.pipe(zlib.createInflateRaw());\n            }\n            output = new Response(body, response_options);\n            resolve(output);\n          });\n          return;\n        }\n        output = new Response(body, response_options);\n        resolve(output);\n        return;\n      });\n      if (typeof options.body === 'string') {\n        req.write(options.body);\n        req.end();\n      } else if (options.body instanceof Buffer) {\n        req.write(options.body);\n        req.end();\n      } else if (typeof options.body === 'object' && options.body.pipe) {\n        options.body.pipe(req);\n      } else if (typeof options.body === 'object') {\n        req.write(options.body.toString());\n        req.end();\n      } else {\n        req.end();\n      }\n    });\n  }\n  ;\n  Fetch.prototype.isRedirect = function(code) {\n    return code === 301 || code === 302 || code === 303 || code === 307 || code === 308;\n  };\n  Fetch.Promise = global.Promise;\n  Fetch.Response = Response;\n  Fetch.Headers = Headers;\n  Fetch.Request = Request;\n})(require('buffer').Buffer);\n"]}