{"version":3,"sources":["../../../../../jspm_packages/npm/browserify-zlib@0.1.4/test/test-zlib.js"],"names":["Buffer","process","assert","require","zlib","path","zlibPairs","Deflate","Inflate","Gzip","Gunzip","Unzip","DeflateRaw","InflateRaw","trickle","chunkSize","level","windowBits","memLevel","strategy","env","PUMMEL","fs","FAST","tests","readFileSync","__dirname","util","stream","BufferStream","chunks","length","writable","readable","inherits","Stream","prototype","write","c","push","end","buf","i","forEach","copy","emit","SlowStream","offset","Error","pause","paused","resume","self","ended","chunk","Math","min","slice","nextTick","tape","Object","keys","file","test","pair","Def","Inf","opts","msg","JSON","stringify","name","t","plan","def","inf","ss","on","deepEqual","pipe"],"mappings":"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","file":"test-zlib.js","sourcesContent":["/* */ \n(function(Buffer, process) {\n  var assert = require('assert');\n  var zlib = require('../src/index');\n  var path = require('path');\n  var zlibPairs = [[zlib.Deflate, zlib.Inflate], [zlib.Gzip, zlib.Gunzip], [zlib.Deflate, zlib.Unzip], [zlib.Gzip, zlib.Unzip], [zlib.DeflateRaw, zlib.InflateRaw]];\n  var trickle = [128, 1024, 1024 * 1024];\n  var chunkSize = [128, 1024, 1024 * 16, 1024 * 1024];\n  var level = [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n  var windowBits = [8, 9, 10, 11, 12, 13, 14, 15];\n  var memLevel = [1, 2, 3, 4, 5, 6, 7, 8, 9];\n  var strategy = [0, 1, 2, 3, 4];\n  if (!process.env.PUMMEL) {\n    trickle = [1024];\n    chunkSize = [1024 * 16];\n    level = [6];\n    memLevel = [8];\n    windowBits = [15];\n    strategy = [0];\n  }\n  var fs = require('fs');\n  if (process.env.FAST) {\n    zlibPairs = [[zlib.Gzip, zlib.Unzip]];\n  }\n  var tests = {\n    'person.jpg': fs.readFileSync(__dirname + '/fixtures/person.jpg'),\n    'elipses.txt': fs.readFileSync(__dirname + '/fixtures/elipses.txt'),\n    'empty.txt': fs.readFileSync(__dirname + '/fixtures/empty.txt')\n  };\n  var util = require('util');\n  var stream = require('stream');\n  function BufferStream() {\n    this.chunks = [];\n    this.length = 0;\n    this.writable = true;\n    this.readable = true;\n  }\n  util.inherits(BufferStream, stream.Stream);\n  BufferStream.prototype.write = function(c) {\n    this.chunks.push(c);\n    this.length += c.length;\n    return true;\n  };\n  BufferStream.prototype.end = function(c) {\n    if (c)\n      this.write(c);\n    var buf = new Buffer(this.length);\n    var i = 0;\n    this.chunks.forEach(function(c) {\n      c.copy(buf, i);\n      i += c.length;\n    });\n    this.emit('data', buf);\n    this.emit('end');\n    return true;\n  };\n  function SlowStream(trickle) {\n    this.trickle = trickle;\n    this.offset = 0;\n    this.readable = this.writable = true;\n  }\n  util.inherits(SlowStream, stream.Stream);\n  SlowStream.prototype.write = function() {\n    throw new Error('not implemented, just call ss.end(chunk)');\n  };\n  SlowStream.prototype.pause = function() {\n    this.paused = true;\n    this.emit('pause');\n  };\n  SlowStream.prototype.resume = function() {\n    var self = this;\n    if (self.ended)\n      return;\n    self.emit('resume');\n    if (!self.chunk)\n      return;\n    self.paused = false;\n    emit();\n    function emit() {\n      if (self.paused)\n        return;\n      if (self.offset >= self.length) {\n        self.ended = true;\n        return self.emit('end');\n      }\n      var end = Math.min(self.offset + self.trickle, self.length);\n      var c = self.chunk.slice(self.offset, end);\n      self.offset += c.length;\n      self.emit('data', c);\n      process.nextTick(emit);\n    }\n  };\n  SlowStream.prototype.end = function(chunk) {\n    var self = this;\n    self.chunk = chunk;\n    self.length = chunk.length;\n    self.resume();\n    return self.ended;\n  };\n  var tape = require('tape');\n  Object.keys(tests).forEach(function(file) {\n    var test = tests[file];\n    chunkSize.forEach(function(chunkSize) {\n      trickle.forEach(function(trickle) {\n        windowBits.forEach(function(windowBits) {\n          level.forEach(function(level) {\n            memLevel.forEach(function(memLevel) {\n              strategy.forEach(function(strategy) {\n                zlibPairs.forEach(function(pair) {\n                  var Def = pair[0];\n                  var Inf = pair[1];\n                  var opts = {\n                    level: level,\n                    windowBits: windowBits,\n                    memLevel: memLevel,\n                    strategy: strategy\n                  };\n                  var msg = file + ' ' + chunkSize + ' ' + JSON.stringify(opts) + ' ' + Def.name + ' -> ' + Inf.name;\n                  tape('zlib ' + msg, function(t) {\n                    t.plan(1);\n                    var def = new Def(opts);\n                    var inf = new Inf(opts);\n                    var ss = new SlowStream(trickle);\n                    var buf = new BufferStream();\n                    buf.on('data', function(c) {\n                      t.deepEqual(c, test);\n                    });\n                    ss.pipe(def).pipe(inf).pipe(buf);\n                    ss.end(test);\n                  });\n                });\n              });\n            });\n          });\n        });\n      });\n    });\n  });\n})(require('buffer').Buffer, require('process'));\n"]}