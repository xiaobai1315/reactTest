{"version":3,"sources":["../../../../jspm_packages/npm/vm-browserify@0.0.4/index.js"],"names":["indexOf","require","Object_keys","obj","Object","keys","res","key","push","forEach","xs","fn","i","length","defineProp","defineProperty","name","value","writable","enumerable","configurable","e","globals","Context","prototype","Script","exports","NodeScript","code","runInContext","context","TypeError","iframe","document","createElement","style","display","body","appendChild","win","contentWindow","wEval","eval","wExecScript","execScript","call","winKeys","removeChild","runInThisContext","runInNewContext","ctx","createContext","s","apply","slice","arguments","createScript","copy"],"mappings":"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","file":"index.js","sourcesContent":["/* */ \nvar indexOf = require('indexof');\n\nvar Object_keys = function (obj) {\n    if (Object.keys) return Object.keys(obj)\n    else {\n        var res = [];\n        for (var key in obj) res.push(key)\n        return res;\n    }\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nvar defineProp = (function() {\n    try {\n        Object.defineProperty({}, '_', {});\n        return function(obj, name, value) {\n            Object.defineProperty(obj, name, {\n                writable: true,\n                enumerable: false,\n                configurable: true,\n                value: value\n            })\n        };\n    } catch(e) {\n        return function(obj, name, value) {\n            obj[name] = value;\n        };\n    }\n}());\n\nvar globals = ['Array', 'Boolean', 'Date', 'Error', 'EvalError', 'Function',\n'Infinity', 'JSON', 'Math', 'NaN', 'Number', 'Object', 'RangeError',\n'ReferenceError', 'RegExp', 'String', 'SyntaxError', 'TypeError', 'URIError',\n'decodeURI', 'decodeURIComponent', 'encodeURI', 'encodeURIComponent', 'escape',\n'eval', 'isFinite', 'isNaN', 'parseFloat', 'parseInt', 'undefined', 'unescape'];\n\nfunction Context() {}\nContext.prototype = {};\n\nvar Script = exports.Script = function NodeScript (code) {\n    if (!(this instanceof Script)) return new Script(code);\n    this.code = code;\n};\n\nScript.prototype.runInContext = function (context) {\n    if (!(context instanceof Context)) {\n        throw new TypeError(\"needs a 'context' argument.\");\n    }\n    \n    var iframe = document.createElement('iframe');\n    if (!iframe.style) iframe.style = {};\n    iframe.style.display = 'none';\n    \n    document.body.appendChild(iframe);\n    \n    var win = iframe.contentWindow;\n    var wEval = win.eval, wExecScript = win.execScript;\n\n    if (!wEval && wExecScript) {\n        // win.eval() magically appears when this is called in IE:\n        wExecScript.call(win, 'null');\n        wEval = win.eval;\n    }\n    \n    forEach(Object_keys(context), function (key) {\n        win[key] = context[key];\n    });\n    forEach(globals, function (key) {\n        if (context[key]) {\n            win[key] = context[key];\n        }\n    });\n    \n    var winKeys = Object_keys(win);\n\n    var res = wEval.call(win, this.code);\n    \n    forEach(Object_keys(win), function (key) {\n        // Avoid copying circular objects like `top` and `window` by only\n        // updating existing context properties or new properties in the `win`\n        // that was only introduced after the eval.\n        if (key in context || indexOf(winKeys, key) === -1) {\n            context[key] = win[key];\n        }\n    });\n\n    forEach(globals, function (key) {\n        if (!(key in context)) {\n            defineProp(context, key, win[key]);\n        }\n    });\n    \n    document.body.removeChild(iframe);\n    \n    return res;\n};\n\nScript.prototype.runInThisContext = function () {\n    return eval(this.code); // maybe...\n};\n\nScript.prototype.runInNewContext = function (context) {\n    var ctx = Script.createContext(context);\n    var res = this.runInContext(ctx);\n\n    forEach(Object_keys(ctx), function (key) {\n        context[key] = ctx[key];\n    });\n\n    return res;\n};\n\nforEach(Object_keys(Script.prototype), function (name) {\n    exports[name] = Script[name] = function (code) {\n        var s = Script(code);\n        return s[name].apply(s, [].slice.call(arguments, 1));\n    };\n});\n\nexports.createScript = function (code) {\n    return exports.Script(code);\n};\n\nexports.createContext = Script.createContext = function (context) {\n    var copy = new Context();\n    if(typeof context === 'object') {\n        forEach(Object_keys(context), function (key) {\n            copy[key] = context[key];\n        });\n    }\n    return copy;\n};\n"]}