{"version":3,"sources":["../../../../../jspm_packages/npm/promise@7.3.1/setimmediate/node-extensions.js"],"names":["Promise","require","module","exports","denodeify","fn","argumentCount","Infinity","denodeifyWithCount","denodeifyWithoutCount","callbackFn","args","i","push","body","join","concat","Function","fnLength","Math","max","length","map","_","index","slice","nodeify","Array","prototype","call","arguments","callback","pop","ctx","apply","ex","resolve","reject","setImmediate","then","value","err"],"mappings":"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","file":"node-extensions.js","sourcesContent":["/* */ \n'use strict';\nvar Promise = require('./core');\nmodule.exports = Promise;\nPromise.denodeify = function(fn, argumentCount) {\n  if (typeof argumentCount === 'number' && argumentCount !== Infinity) {\n    return denodeifyWithCount(fn, argumentCount);\n  } else {\n    return denodeifyWithoutCount(fn);\n  }\n};\nvar callbackFn = ('function (err, res) {' + 'if (err) { rj(err); } else { rs(res); }' + '}');\nfunction denodeifyWithCount(fn, argumentCount) {\n  var args = [];\n  for (var i = 0; i < argumentCount; i++) {\n    args.push('a' + i);\n  }\n  var body = ['return function (' + args.join(',') + ') {', 'var self = this;', 'return new Promise(function (rs, rj) {', 'var res = fn.call(', ['self'].concat(args).concat([callbackFn]).join(','), ');', 'if (res &&', '(typeof res === \"object\" || typeof res === \"function\") &&', 'typeof res.then === \"function\"', ') {rs(res);}', '});', '};'].join('');\n  return Function(['Promise', 'fn'], body)(Promise, fn);\n}\nfunction denodeifyWithoutCount(fn) {\n  var fnLength = Math.max(fn.length - 1, 3);\n  var args = [];\n  for (var i = 0; i < fnLength; i++) {\n    args.push('a' + i);\n  }\n  var body = ['return function (' + args.join(',') + ') {', 'var self = this;', 'var args;', 'var argLength = arguments.length;', 'if (arguments.length > ' + fnLength + ') {', 'args = new Array(arguments.length + 1);', 'for (var i = 0; i < arguments.length; i++) {', 'args[i] = arguments[i];', '}', '}', 'return new Promise(function (rs, rj) {', 'var cb = ' + callbackFn + ';', 'var res;', 'switch (argLength) {', args.concat(['extra']).map(function(_, index) {\n    return ('case ' + (index) + ':' + 'res = fn.call(' + ['self'].concat(args.slice(0, index)).concat('cb').join(',') + ');' + 'break;');\n  }).join(''), 'default:', 'args[argLength] = cb;', 'res = fn.apply(self, args);', '}', 'if (res &&', '(typeof res === \"object\" || typeof res === \"function\") &&', 'typeof res.then === \"function\"', ') {rs(res);}', '});', '};'].join('');\n  return Function(['Promise', 'fn'], body)(Promise, fn);\n}\nPromise.nodeify = function(fn) {\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    var callback = typeof args[args.length - 1] === 'function' ? args.pop() : null;\n    var ctx = this;\n    try {\n      return fn.apply(this, arguments).nodeify(callback, ctx);\n    } catch (ex) {\n      if (callback === null || typeof callback == 'undefined') {\n        return new Promise(function(resolve, reject) {\n          reject(ex);\n        });\n      } else {\n        setImmediate(function() {\n          callback.call(ctx, ex);\n        });\n      }\n    }\n  };\n};\nPromise.prototype.nodeify = function(callback, ctx) {\n  if (typeof callback != 'function')\n    return this;\n  this.then(function(value) {\n    setImmediate(function() {\n      callback.call(ctx, null, value);\n    });\n  }, function(err) {\n    setImmediate(function() {\n      callback.call(ctx, err);\n    });\n  });\n};\n"]}