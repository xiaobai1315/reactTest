{"version":3,"sources":["../../../../../jspm_packages/npm/promise@7.3.1/src/core.js"],"names":["asap","require","noop","LAST_ERROR","IS_ERROR","getThen","obj","then","ex","tryCallOne","fn","a","tryCallTwo","b","module","exports","Promise","TypeError","_deferredState","_state","_value","_deferreds","doResolve","_onHandle","_onReject","_noop","prototype","onFulfilled","onRejected","constructor","safeThen","res","handle","Handler","self","resolve","reject","deferred","push","handleResolved","cb","promise","ret","newValue","finale","bind","i","length","done","value","reason"],"mappings":"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","file":"core.js","sourcesContent":["/* */ \n'use strict';\n\nvar asap = require('asap/raw');\n\nfunction noop() {}\n\n// States:\n//\n// 0 - pending\n// 1 - fulfilled with _value\n// 2 - rejected with _value\n// 3 - adopted the state of another promise, _value\n//\n// once the state is no longer pending (0) it is immutable\n\n// All `_` prefixed properties will be reduced to `_{random number}`\n// at build time to obfuscate them and discourage their use.\n// We don't use symbols or Object.defineProperty to fully hide them\n// because the performance isn't good enough.\n\n\n// to avoid using try/catch inside critical functions, we\n// extract them to here.\nvar LAST_ERROR = null;\nvar IS_ERROR = {};\nfunction getThen(obj) {\n  try {\n    return obj.then;\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\n\nfunction tryCallOne(fn, a) {\n  try {\n    return fn(a);\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\nfunction tryCallTwo(fn, a, b) {\n  try {\n    fn(a, b);\n  } catch (ex) {\n    LAST_ERROR = ex;\n    return IS_ERROR;\n  }\n}\n\nmodule.exports = Promise;\n\nfunction Promise(fn) {\n  if (typeof this !== 'object') {\n    throw new TypeError('Promises must be constructed via new');\n  }\n  if (typeof fn !== 'function') {\n    throw new TypeError('Promise constructor\\'s argument is not a function');\n  }\n  this._deferredState = 0;\n  this._state = 0;\n  this._value = null;\n  this._deferreds = null;\n  if (fn === noop) return;\n  doResolve(fn, this);\n}\nPromise._onHandle = null;\nPromise._onReject = null;\nPromise._noop = noop;\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  if (this.constructor !== Promise) {\n    return safeThen(this, onFulfilled, onRejected);\n  }\n  var res = new Promise(noop);\n  handle(this, new Handler(onFulfilled, onRejected, res));\n  return res;\n};\n\nfunction safeThen(self, onFulfilled, onRejected) {\n  return new self.constructor(function (resolve, reject) {\n    var res = new Promise(noop);\n    res.then(resolve, reject);\n    handle(self, new Handler(onFulfilled, onRejected, res));\n  });\n}\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (Promise._onHandle) {\n    Promise._onHandle(self);\n  }\n  if (self._state === 0) {\n    if (self._deferredState === 0) {\n      self._deferredState = 1;\n      self._deferreds = deferred;\n      return;\n    }\n    if (self._deferredState === 1) {\n      self._deferredState = 2;\n      self._deferreds = [self._deferreds, deferred];\n      return;\n    }\n    self._deferreds.push(deferred);\n    return;\n  }\n  handleResolved(self, deferred);\n}\n\nfunction handleResolved(self, deferred) {\n  asap(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      if (self._state === 1) {\n        resolve(deferred.promise, self._value);\n      } else {\n        reject(deferred.promise, self._value);\n      }\n      return;\n    }\n    var ret = tryCallOne(cb, self._value);\n    if (ret === IS_ERROR) {\n      reject(deferred.promise, LAST_ERROR);\n    } else {\n      resolve(deferred.promise, ret);\n    }\n  });\n}\nfunction resolve(self, newValue) {\n  // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n  if (newValue === self) {\n    return reject(\n      self,\n      new TypeError('A promise cannot be resolved with itself.')\n    );\n  }\n  if (\n    newValue &&\n    (typeof newValue === 'object' || typeof newValue === 'function')\n  ) {\n    var then = getThen(newValue);\n    if (then === IS_ERROR) {\n      return reject(self, LAST_ERROR);\n    }\n    if (\n      then === self.then &&\n      newValue instanceof Promise\n    ) {\n      self._state = 3;\n      self._value = newValue;\n      finale(self);\n      return;\n    } else if (typeof then === 'function') {\n      doResolve(then.bind(newValue), self);\n      return;\n    }\n  }\n  self._state = 1;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  if (Promise._onReject) {\n    Promise._onReject(self, newValue);\n  }\n  finale(self);\n}\nfunction finale(self) {\n  if (self._deferredState === 1) {\n    handle(self, self._deferreds);\n    self._deferreds = null;\n  }\n  if (self._deferredState === 2) {\n    for (var i = 0; i < self._deferreds.length; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n}\n\nfunction Handler(onFulfilled, onRejected, promise){\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, promise) {\n  var done = false;\n  var res = tryCallTwo(fn, function (value) {\n    if (done) return;\n    done = true;\n    resolve(promise, value);\n  }, function (reason) {\n    if (done) return;\n    done = true;\n    reject(promise, reason);\n  });\n  if (!done && res === IS_ERROR) {\n    done = true;\n    reject(promise, LAST_ERROR);\n  }\n}\n"]}