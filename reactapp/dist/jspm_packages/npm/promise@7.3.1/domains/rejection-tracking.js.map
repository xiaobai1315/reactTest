{"version":3,"sources":["../../../../../jspm_packages/npm/promise@7.3.1/domains/rejection-tracking.js"],"names":["Promise","require","DEFAULT_WHITELIST","ReferenceError","TypeError","RangeError","enabled","exports","disable","_37","_87","enable","options","id","displayId","rejections","promise","_65","_51","logged","onHandled","clearTimeout","timeout","err","_40","error","setTimeout","onUnhandled","bind","matchWhitelist","allRejections","whitelist","logError","console","warn","errStr","stack","split","forEach","line","list","some","cls"],"mappings":"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","file":"rejection-tracking.js","sourcesContent":["/* */ \n'use strict';\nvar Promise = require('./core');\nvar DEFAULT_WHITELIST = [ReferenceError, TypeError, RangeError];\nvar enabled = false;\nexports.disable = disable;\nfunction disable() {\n  enabled = false;\n  Promise._37 = null;\n  Promise._87 = null;\n}\nexports.enable = enable;\nfunction enable(options) {\n  options = options || {};\n  if (enabled)\n    disable();\n  enabled = true;\n  var id = 0;\n  var displayId = 0;\n  var rejections = {};\n  Promise._37 = function(promise) {\n    if (promise._65 === 2 && rejections[promise._51]) {\n      if (rejections[promise._51].logged) {\n        onHandled(promise._51);\n      } else {\n        clearTimeout(rejections[promise._51].timeout);\n      }\n      delete rejections[promise._51];\n    }\n  };\n  Promise._87 = function(promise, err) {\n    if (promise._40 === 0) {\n      promise._51 = id++;\n      rejections[promise._51] = {\n        displayId: null,\n        error: err,\n        timeout: setTimeout(onUnhandled.bind(null, promise._51), matchWhitelist(err, DEFAULT_WHITELIST) ? 100 : 2000),\n        logged: false\n      };\n    }\n  };\n  function onUnhandled(id) {\n    if (options.allRejections || matchWhitelist(rejections[id].error, options.whitelist || DEFAULT_WHITELIST)) {\n      rejections[id].displayId = displayId++;\n      if (options.onUnhandled) {\n        rejections[id].logged = true;\n        options.onUnhandled(rejections[id].displayId, rejections[id].error);\n      } else {\n        rejections[id].logged = true;\n        logError(rejections[id].displayId, rejections[id].error);\n      }\n    }\n  }\n  function onHandled(id) {\n    if (rejections[id].logged) {\n      if (options.onHandled) {\n        options.onHandled(rejections[id].displayId, rejections[id].error);\n      } else if (!rejections[id].onUnhandled) {\n        console.warn('Promise Rejection Handled (id: ' + rejections[id].displayId + '):');\n        console.warn('  This means you can ignore any previous messages of the form \"Possible Unhandled Promise Rejection\" with id ' + rejections[id].displayId + '.');\n      }\n    }\n  }\n}\nfunction logError(id, error) {\n  console.warn('Possible Unhandled Promise Rejection (id: ' + id + '):');\n  var errStr = (error && (error.stack || error)) + '';\n  errStr.split('\\n').forEach(function(line) {\n    console.warn('  ' + line);\n  });\n}\nfunction matchWhitelist(error, list) {\n  return list.some(function(cls) {\n    return error instanceof cls;\n  });\n}\n"]}