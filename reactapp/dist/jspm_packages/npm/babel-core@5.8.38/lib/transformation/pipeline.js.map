{"version":3,"sources":["../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/pipeline.js"],"names":["exports","__esModule","_interopRequireDefault","obj","_classCallCheck","instance","Constructor","TypeError","_filePluginManager","require","_filePluginManager2","_helpersNormalizeAst","_helpersNormalizeAst2","_plugin","_plugin2","_lodashObjectAssign","_lodashObjectAssign2","_helpersObject","_helpersObject2","_file","_file2","Pipeline","transformers","namespaces","deprecated","aliases","filters","prototype","addTransformers","key","addTransformer","plugin","Error","namespace","split","push","memoisePluginContainer","metadata","optional","addAliases","names","addDeprecated","addFilter","filter","canTransform","fileOpts","_arr","_i","length","result","analyze","code","opts","arguments","undefined","transform","pretransform","file","wrap","addCode","parseCode","transformFromAst","ast","addAst","_ensureTransformerNames","type","rawKeys","keys","i","deprecatedKey","aliasKey","console","error","concat","ReferenceError","module"],"mappings":"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","file":"pipeline.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _filePluginManager = require(\"./file/plugin-manager\");\n\nvar _filePluginManager2 = _interopRequireDefault(_filePluginManager);\n\nvar _helpersNormalizeAst = require(\"../helpers/normalize-ast\");\n\nvar _helpersNormalizeAst2 = _interopRequireDefault(_helpersNormalizeAst);\n\nvar _plugin = require(\"./plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _lodashObjectAssign = require(\"lodash/object/assign\");\n\nvar _lodashObjectAssign2 = _interopRequireDefault(_lodashObjectAssign);\n\nvar _helpersObject = require(\"../helpers/object\");\n\nvar _helpersObject2 = _interopRequireDefault(_helpersObject);\n\nvar _file = require(\"./file\");\n\nvar _file2 = _interopRequireDefault(_file);\n\n/**\n * [Please add a description.]\n */\n\nvar Pipeline = (function () {\n  function Pipeline() {\n    _classCallCheck(this, Pipeline);\n\n    this.transformers = _helpersObject2[\"default\"]();\n    this.namespaces = _helpersObject2[\"default\"]();\n    this.deprecated = _helpersObject2[\"default\"]();\n    this.aliases = _helpersObject2[\"default\"]();\n    this.filters = [];\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addTransformers = function addTransformers(transformers) {\n    for (var key in transformers) {\n      this.addTransformer(key, transformers[key]);\n    }\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addTransformer = function addTransformer(key, plugin) {\n    if (this.transformers[key]) throw new Error(); // todo: error\n\n    var namespace = key.split(\".\")[0];\n    this.namespaces[namespace] = this.namespaces[namespace] || [];\n    this.namespaces[namespace].push(key);\n    this.namespaces[key] = namespace;\n\n    if (typeof plugin === \"function\") {\n      plugin = _filePluginManager2[\"default\"].memoisePluginContainer(plugin);\n      plugin.key = key;\n      plugin.metadata.optional = true;\n\n      if (key === \"react.displayName\") {\n        plugin.metadata.optional = false;\n      }\n    } else {\n      plugin = new _plugin2[\"default\"](key, plugin);\n    }\n\n    this.transformers[key] = plugin;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addAliases = function addAliases(names) {\n    _lodashObjectAssign2[\"default\"](this.aliases, names);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addDeprecated = function addDeprecated(names) {\n    _lodashObjectAssign2[\"default\"](this.deprecated, names);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.addFilter = function addFilter(filter) {\n    this.filters.push(filter);\n    return this;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.canTransform = function canTransform(plugin, fileOpts) {\n    if (plugin.metadata.plugin) {\n      return true;\n    }\n\n    var _arr = this.filters;\n    for (var _i = 0; _i < _arr.length; _i++) {\n      var filter = _arr[_i];\n      var result = filter(plugin, fileOpts);\n      if (result != null) return result;\n    }\n\n    return true;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.analyze = function analyze(code) {\n    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    opts.code = false;\n    return this.transform(code, opts);\n  };\n\n  /**\n   * Build dependency graph by recursing `metadata.modules`. WIP.\n   */\n\n  Pipeline.prototype.pretransform = function pretransform(code, opts) {\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.parseCode(code);\n      return file;\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.transform = function transform(code, opts) {\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.parseCode(code);\n      return file.transform();\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype.transformFromAst = function transformFromAst(ast, code, opts) {\n    ast = _helpersNormalizeAst2[\"default\"](ast);\n\n    var file = new _file2[\"default\"](opts, this);\n    return file.wrap(code, function () {\n      file.addCode(code);\n      file.addAst(ast);\n      return file.transform();\n    });\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  Pipeline.prototype._ensureTransformerNames = function _ensureTransformerNames(type, rawKeys) {\n    var keys = [];\n\n    for (var i = 0; i < rawKeys.length; i++) {\n      var key = rawKeys[i];\n      var deprecatedKey = this.deprecated[key];\n      var aliasKey = this.aliases[key];\n      if (aliasKey) {\n        keys.push(aliasKey);\n      } else if (deprecatedKey) {\n        // deprecated key, remap it to the new one\n        console.error(\"[BABEL] The transformer \" + key + \" has been renamed to \" + deprecatedKey);\n        rawKeys.push(deprecatedKey);\n      } else if (this.transformers[key]) {\n        // valid key\n        keys.push(key);\n      } else if (this.namespaces[key]) {\n        // namespace, append all transformers within this namespace\n        keys = keys.concat(this.namespaces[key]);\n      } else {\n        // invalid key\n        throw new ReferenceError(\"Unknown transformer \" + key + \" specified in \" + type);\n      }\n    }\n\n    return keys;\n  };\n\n  return Pipeline;\n})();\n\nexports[\"default\"] = Pipeline;\nmodule.exports = exports[\"default\"];"]}