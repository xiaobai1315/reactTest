{"version":3,"sources":["../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/file/plugin-manager.js"],"names":["exports","__esModule","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_interopRequireWildcard","obj","newObj","hasOwnProperty","call","_interopRequireDefault","_classCallCheck","instance","TypeError","_transformer","require","_transformer2","_plugin","_plugin2","_types","types","_messages","messages","_tryResolve","_tryResolve2","_traversal","_traversal2","_helpersParse","_helpersParse2","context","Transformer","Plugin","parse","traverse","PluginManager","memoisePluginContainer","fn","memoisedPlugins","plugin","container","transformer","push","value","_ref","arguments","undefined","transformers","before","after","file","subnormaliseString","name","position","match","loc","relative","ReferenceError","get","validate","buildPass","constructor","metadata","add","_subnormaliseString","positions","indexOf","pass","canTransform","stack","module"],"mappings":"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","file":"plugin-manager.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _transformer = require(\"../transformer\");\n\nvar _transformer2 = _interopRequireDefault(_transformer);\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _types = require(\"../../types\");\n\nvar types = _interopRequireWildcard(_types);\n\nvar _messages = require(\"../../messages\");\n\nvar messages = _interopRequireWildcard(_messages);\n\nvar _tryResolve = require(\"try-resolve\");\n\nvar _tryResolve2 = _interopRequireDefault(_tryResolve);\n\nvar _traversal = require(\"../../traversal\");\n\nvar _traversal2 = _interopRequireDefault(_traversal);\n\nvar _helpersParse = require(\"../../helpers/parse\");\n\nvar _helpersParse2 = _interopRequireDefault(_helpersParse);\n\n/**\n * [Please add a description.]\n */\n\nvar context = {\n  messages: messages,\n  Transformer: _transformer2[\"default\"],\n  Plugin: _plugin2[\"default\"],\n  types: types,\n  parse: _helpersParse2[\"default\"],\n  traverse: _traversal2[\"default\"]\n};\n\n/**\n * [Please add a description.]\n */\n\nvar PluginManager = (function () {\n\n  /**\n   * [Please add a description.]\n   */\n\n  PluginManager.memoisePluginContainer = function memoisePluginContainer(fn) {\n    for (var i = 0; i < PluginManager.memoisedPlugins.length; i++) {\n      var plugin = PluginManager.memoisedPlugins[i];\n      if (plugin.container === fn) return plugin.transformer;\n    }\n\n    var transformer = fn(context);\n    PluginManager.memoisedPlugins.push({\n      container: fn,\n      transformer: transformer\n    });\n    return transformer;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  _createClass(PluginManager, null, [{\n    key: \"memoisedPlugins\",\n\n    /**\n     * [Please add a description.]\n     */\n\n    value: [],\n    enumerable: true\n  }, {\n    key: \"positions\",\n    value: [\"before\", \"after\"],\n\n    /**\n     * [Please add a description.]\n     */\n\n    enumerable: true\n  }]);\n\n  function PluginManager() {\n    var _ref = arguments.length <= 0 || arguments[0] === undefined ? { transformers: {}, before: [], after: [] } : arguments[0];\n\n    var file = _ref.file;\n    var transformers = _ref.transformers;\n    var before = _ref.before;\n    var after = _ref.after;\n\n    _classCallCheck(this, PluginManager);\n\n    this.transformers = transformers;\n    this.file = file;\n    this.before = before;\n    this.after = after;\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  PluginManager.prototype.subnormaliseString = function subnormaliseString(name, position) {\n    // this is a plugin in the form of \"foobar\" or \"foobar:after\"\n    // where the optional colon is the delimiter for plugin position in the transformer stack\n\n    var match = name.match(/^(.*?):(after|before)$/);\n    if (match) {\n      ;\n\n      name = match[1];\n      position = match[2];\n    }var loc = _tryResolve2[\"default\"].relative(\"babel-plugin-\" + name) || _tryResolve2[\"default\"].relative(name);\n    if (loc) {\n      var plugin = require(loc);\n      return {\n        position: position,\n        plugin: plugin[\"default\"] || plugin\n      };\n    } else {\n      throw new ReferenceError(messages.get(\"pluginUnknown\", name));\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PluginManager.prototype.validate = function validate(name, plugin) {\n    // validate transformer key\n    var key = plugin.key;\n    if (this.transformers[key]) {\n      throw new ReferenceError(messages.get(\"pluginKeyCollision\", key));\n    }\n\n    // validate Transformer instance\n    if (!plugin.buildPass || plugin.constructor.name !== \"Plugin\") {\n      throw new TypeError(messages.get(\"pluginNotTransformer\", name));\n    }\n\n    // register as a plugin\n    plugin.metadata.plugin = true;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  PluginManager.prototype.add = function add(name) {\n    var position;\n    var plugin;\n\n    if (name) {\n      if (typeof name === \"object\" && name.transformer) {\n        plugin = name.transformer;\n        position = name.position;\n      } else if (typeof name !== \"string\") {\n        // not a string so we'll just assume that it's a direct Transformer instance, if not then\n        // the checks later on will complain\n        plugin = name;\n      }\n\n      if (typeof name === \"string\") {\n        var _subnormaliseString = this.subnormaliseString(name, position);\n\n        plugin = _subnormaliseString.plugin;\n        position = _subnormaliseString.position;\n      }\n    } else {\n      throw new TypeError(messages.get(\"pluginIllegalKind\", typeof name, name));\n    }\n\n    // default position\n    position = position || \"before\";\n\n    // validate position\n    if (PluginManager.positions.indexOf(position) < 0) {\n      throw new TypeError(messages.get(\"pluginIllegalPosition\", position, name));\n    }\n\n    // allow plugin containers to be specified so they don't have to manually require\n    if (typeof plugin === \"function\") {\n      plugin = PluginManager.memoisePluginContainer(plugin);\n    }\n\n    //\n    this.validate(name, plugin);\n\n    // build!\n    var pass = this.transformers[plugin.key] = plugin.buildPass(this.file);\n    if (pass.canTransform()) {\n      var stack = position === \"before\" ? this.before : this.after;\n      stack.push(pass);\n    }\n  };\n\n  return PluginManager;\n})();\n\nexports[\"default\"] = PluginManager;\nmodule.exports = exports[\"default\"];"]}