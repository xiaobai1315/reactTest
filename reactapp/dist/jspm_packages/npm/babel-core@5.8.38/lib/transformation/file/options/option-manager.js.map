{"version":3,"sources":["../../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/file/options/option-manager.js"],"names":["exports","__esModule","_interopRequireDefault","obj","_classCallCheck","instance","Constructor","TypeError","_index","require","_json5","_json52","_pathIsAbsolute","_pathIsAbsolute2","_pathExists","_pathExists2","_lodashLangClone","_lodashLangClone2","_helpersMerge","_helpersMerge2","_config","_config2","_path","_path2","_fs","_fs2","existsCache","jsonCache","BABELIGNORE_FILENAME","BABELRC_FILENAME","PACKAGE_FILENAME","exists","filename","cached","sync","OptionManager","log","pipeline","resolvedConfigs","options","createBareOptions","opts","key","opt","prototype","addConfig","loc","json","arguments","length","undefined","indexOf","content","readFileSync","parse","err","message","mergeOptions","push","alias","option","error","ReferenceError","normaliseOptions","addIgnoreConfig","file","lines","split","map","line","replace","trim","filter","ignore","findConfigs","join","process","cwd","dirname","breakConfig","configLoc","pkgLoc","JSON","ignoreLoc","val","optional","deprecated","deprecate","validateOption","init","babelrc","_arr","_i","envKey","env","BABEL_ENV","NODE_ENV","module"],"mappings":"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","file":"option-manager.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _index = require(\"./index\");\n\nvar _json5 = require(\"json5\");\n\nvar _json52 = _interopRequireDefault(_json5);\n\nvar _pathIsAbsolute = require(\"path-is-absolute\");\n\nvar _pathIsAbsolute2 = _interopRequireDefault(_pathIsAbsolute);\n\nvar _pathExists = require(\"path-exists\");\n\nvar _pathExists2 = _interopRequireDefault(_pathExists);\n\nvar _lodashLangClone = require(\"lodash/lang/clone\");\n\nvar _lodashLangClone2 = _interopRequireDefault(_lodashLangClone);\n\nvar _helpersMerge = require(\"../../../helpers/merge\");\n\nvar _helpersMerge2 = _interopRequireDefault(_helpersMerge);\n\nvar _config = require(\"./config\");\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar existsCache = {};\nvar jsonCache = {};\n\nvar BABELIGNORE_FILENAME = \".babelignore\";\nvar BABELRC_FILENAME = \".babelrc\";\nvar PACKAGE_FILENAME = \"package.json\";\n\nfunction exists(filename) {\n  var cached = existsCache[filename];\n  if (cached != null) {\n    return cached;\n  } else {\n    return existsCache[filename] = _pathExists2[\"default\"].sync(filename);\n  }\n}\n\nvar OptionManager = (function () {\n  function OptionManager(log, pipeline) {\n    _classCallCheck(this, OptionManager);\n\n    this.resolvedConfigs = [];\n    this.options = OptionManager.createBareOptions();\n    this.pipeline = pipeline;\n    this.log = log;\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.createBareOptions = function createBareOptions() {\n    var opts = {};\n\n    for (var key in _config2[\"default\"]) {\n      var opt = _config2[\"default\"][key];\n      opts[key] = _lodashLangClone2[\"default\"](opt[\"default\"]);\n    }\n\n    return opts;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.addConfig = function addConfig(loc, key) {\n    var json = arguments.length <= 2 || arguments[2] === undefined ? _json52[\"default\"] : arguments[2];\n\n    if (this.resolvedConfigs.indexOf(loc) >= 0) return;\n\n    var content = _fs2[\"default\"].readFileSync(loc, \"utf8\");\n    var opts;\n\n    try {\n      opts = jsonCache[content] = jsonCache[content] || json.parse(content);\n      if (key) opts = opts[key];\n    } catch (err) {\n      err.message = loc + \": Error while parsing JSON - \" + err.message;\n      throw err;\n    }\n\n    this.mergeOptions(opts, loc);\n    this.resolvedConfigs.push(loc);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.mergeOptions = function mergeOptions(opts) {\n    var alias = arguments.length <= 1 || arguments[1] === undefined ? \"foreign\" : arguments[1];\n\n    if (!opts) return;\n\n    for (var key in opts) {\n      if (key[0] === \"_\") continue;\n\n      var option = _config2[\"default\"][key];\n\n      // check for an unknown option\n      if (!option) this.log.error(\"Unknown option: \" + alias + \".\" + key, ReferenceError);\n    }\n\n    // normalise options\n    _index.normaliseOptions(opts);\n\n    // merge them into this current files options\n    _helpersMerge2[\"default\"](this.options, opts);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.addIgnoreConfig = function addIgnoreConfig(loc) {\n    var file = _fs2[\"default\"].readFileSync(loc, \"utf8\");\n    var lines = file.split(\"\\n\");\n\n    lines = lines.map(function (line) {\n      return line.replace(/#(.*?)$/, \"\").trim();\n    }).filter(function (line) {\n      return !!line;\n    });\n\n    this.mergeOptions({ ignore: lines }, loc);\n  };\n\n  /**\n   * Description\n   */\n\n  OptionManager.prototype.findConfigs = function findConfigs(loc) {\n    if (!loc) return;\n\n    if (!_pathIsAbsolute2[\"default\"](loc)) {\n      loc = _path2[\"default\"].join(process.cwd(), loc);\n    }\n\n    while (loc !== (loc = _path2[\"default\"].dirname(loc))) {\n      if (this.options.breakConfig) return;\n\n      var configLoc = _path2[\"default\"].join(loc, BABELRC_FILENAME);\n      if (exists(configLoc)) this.addConfig(configLoc);\n\n      var pkgLoc = _path2[\"default\"].join(loc, PACKAGE_FILENAME);\n      if (exists(pkgLoc)) this.addConfig(pkgLoc, \"babel\", JSON);\n\n      var ignoreLoc = _path2[\"default\"].join(loc, BABELIGNORE_FILENAME);\n      if (exists(ignoreLoc)) this.addIgnoreConfig(ignoreLoc);\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.normaliseOptions = function normaliseOptions() {\n    var opts = this.options;\n\n    for (var key in _config2[\"default\"]) {\n      var option = _config2[\"default\"][key];\n      var val = opts[key];\n\n      // optional\n      if (!val && option.optional) continue;\n\n      // deprecated\n      if (this.log && val && option.deprecated) {\n        this.log.deprecate(\"Deprecated option \" + key + \": \" + option.deprecated);\n      }\n\n      // validate\n      if (this.pipeline && val) {\n        val = _index.validateOption(key, val, this.pipeline);\n      }\n\n      // aaliases\n      if (option.alias) {\n        opts[option.alias] = opts[option.alias] || val;\n      } else {\n        opts[key] = val;\n      }\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  OptionManager.prototype.init = function init(opts) {\n    this.mergeOptions(opts, \"direct\");\n\n    // babelrc option\n    if (opts.babelrc) {\n      var _arr = opts.babelrc;\n\n      for (var _i = 0; _i < _arr.length; _i++) {\n        var loc = _arr[_i];this.addConfig(loc);\n      }\n    }\n\n    // resolve all .babelrc files\n    if (opts.babelrc !== false) {\n      this.findConfigs(opts.filename);\n    }\n\n    // merge in env\n    var envKey = process.env.BABEL_ENV || process.env.NODE_ENV || \"development\";\n    if (this.options.env) {\n      this.mergeOptions(this.options.env[envKey], \"direct.env.\" + envKey);\n    }\n\n    // normalise\n    this.normaliseOptions(opts);\n\n    return this.options;\n  };\n\n  return OptionManager;\n})();\n\nexports[\"default\"] = OptionManager;\nmodule.exports = exports[\"default\"];"]}