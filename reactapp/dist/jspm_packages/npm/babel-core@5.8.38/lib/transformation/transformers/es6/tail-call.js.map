{"version":3,"sources":["../../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/transformers/es6/tail-call.js"],"names":["exports","__esModule","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","_interopRequireDefault","_classCallCheck","instance","Constructor","TypeError","_lodashCollectionReduceRight","require","_lodashCollectionReduceRight2","_messages","messages","_lodashArrayFlatten","_lodashArrayFlatten2","_util","util","_lodashCollectionMap","_lodashCollectionMap2","_types","t","metadata","group","visitor","Function","node","parent","scope","file","generator","async","tailCall","TailCallTransformer","run","returnBlock","expr","blockStatement","returnStatement","enter","isTryStatement","block","skip","finalizer","ReturnStatement","state","subTransform","argument","VariableDeclaration","vars","push","ThisExpression","isShadowed","needsThis","thisPaths","ReferencedIdentifier","name","_shadowedFunctionLiteral","needsArguments","argumentsPaths","path","hasTailRecursion","setsArguments","isArrowFunctionExpression","is","ownerId","id","getArgumentsId","argumentsId","generateUidIdentifier","getThisId","thisId","getLeftId","leftId","getFunctionId","functionId","getAgainId","againId","getParams","params","paramDecls","i","length","param","_isDefaultPlaceholder","variableDeclarator","hasDeopt","ownerIdInfo","getBinding","constant","traverse","log","deopt","get","body","ensureBlock","bodyNode","isFunctionDeclaration","variableDeclaration","toExpression","_blockHoist","paramDecl","Infinity","unshift","expressionStatement","assignmentExpression","literal","template","FUNCTION_ID","AGAIN_ID","BLOCK","topVars","_arr","_i","replaceWith","thisExpression","_arr2","_i2","_path","decl","init","identifier","handler","type","subTransformConditionalExpression","callConsequent","consequent","callAlternate","alternate","toBlock","isIfStatement","subTransformLogicalExpression","callRight","right","testExpr","left","operator","unaryExpression","ifStatement","concat","subTransformSequenceExpression","seq","expressions","lastCall","subTransformCallExpression","callee","thisBinding","args","isMemberExpression","computed","isIdentifier","property","arrayExpression","arguments","slice","object","bindingIdentifierEquals","isThisExpression","isArrayExpression","elems","elements","elem","_arr3","_i3","isPure","memberExpression","declarations","assignment","statement","continueStatement"],"mappings":"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","file":"tail-call.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _lodashCollectionReduceRight = require(\"lodash/collection/reduceRight\");\n\nvar _lodashCollectionReduceRight2 = _interopRequireDefault(_lodashCollectionReduceRight);\n\nvar _messages = require(\"../../../messages\");\n\nvar messages = _interopRequireWildcard(_messages);\n\nvar _lodashArrayFlatten = require(\"lodash/array/flatten\");\n\nvar _lodashArrayFlatten2 = _interopRequireDefault(_lodashArrayFlatten);\n\nvar _util = require(\"../../../util\");\n\nvar util = _interopRequireWildcard(_util);\n\nvar _lodashCollectionMap = require(\"lodash/collection/map\");\n\nvar _lodashCollectionMap2 = _interopRequireDefault(_lodashCollectionMap);\n\nvar _types = require(\"../../../types\");\n\nvar t = _interopRequireWildcard(_types);\n\nvar metadata = {\n  group: \"builtin-trailing\"\n};\n\nexports.metadata = metadata;\n/**\n * [Please add a description.]\n */\n\nvar visitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  Function: function Function(node, parent, scope, file) {\n    if (node.generator || node.async) return;\n    var tailCall = new TailCallTransformer(this, scope, file);\n    tailCall.run();\n  }\n};\n\nexports.visitor = visitor;\n/**\n * [Please add a description.]\n */\n\nfunction returnBlock(expr) {\n  return t.blockStatement([t.returnStatement(expr)]);\n}\n\n/**\n * [Please add a description.]\n */\n\nvar visitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  enter: function enter(node, parent) {\n    if (t.isTryStatement(parent)) {\n      if (node === parent.block) {\n        this.skip();\n      } else if (parent.finalizer && node !== parent.finalizer) {\n        this.skip();\n      }\n    }\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  ReturnStatement: function ReturnStatement(node, parent, scope, state) {\n    return state.subTransform(node.argument);\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  Function: function Function() {\n    this.skip();\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  VariableDeclaration: function VariableDeclaration(node, parent, scope, state) {\n    state.vars.push(node);\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  ThisExpression: function ThisExpression(node, parent, scope, state) {\n    if (!state.isShadowed) {\n      state.needsThis = true;\n      state.thisPaths.push(this);\n    }\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  ReferencedIdentifier: function ReferencedIdentifier(node, parent, scope, state) {\n    if (node.name === \"arguments\" && (!state.isShadowed || node._shadowedFunctionLiteral)) {\n      state.needsArguments = true;\n      state.argumentsPaths.push(this);\n    }\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar TailCallTransformer = (function () {\n  function TailCallTransformer(path, scope, file) {\n    _classCallCheck(this, TailCallTransformer);\n\n    this.hasTailRecursion = false;\n\n    this.needsArguments = false;\n    this.argumentsPaths = [];\n    this.setsArguments = false;\n\n    this.needsThis = false;\n    this.thisPaths = [];\n\n    this.isShadowed = path.isArrowFunctionExpression() || path.is(\"shadow\");\n    this.ownerId = path.node.id;\n    this.vars = [];\n\n    this.scope = scope;\n    this.path = path;\n    this.file = file;\n    this.node = path.node;\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getArgumentsId = function getArgumentsId() {\n    return this.argumentsId = this.argumentsId || this.scope.generateUidIdentifier(\"arguments\");\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getThisId = function getThisId() {\n    return this.thisId = this.thisId || this.scope.generateUidIdentifier(\"this\");\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getLeftId = function getLeftId() {\n    return this.leftId = this.leftId || this.scope.generateUidIdentifier(\"left\");\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getFunctionId = function getFunctionId() {\n    return this.functionId = this.functionId || this.scope.generateUidIdentifier(\"function\");\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getAgainId = function getAgainId() {\n    return this.againId = this.againId || this.scope.generateUidIdentifier(\"again\");\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.getParams = function getParams() {\n    var params = this.params;\n\n    if (!params) {\n      params = this.node.params;\n      this.paramDecls = [];\n\n      for (var i = 0; i < params.length; i++) {\n        var param = params[i];\n        if (!param._isDefaultPlaceholder) {\n          this.paramDecls.push(t.variableDeclarator(param, params[i] = this.scope.generateUidIdentifier(\"x\")));\n        }\n      }\n    }\n\n    return this.params = params;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.hasDeopt = function hasDeopt() {\n    // check if the ownerId has been reassigned, if it has then it's not safe to\n    // perform optimisations\n    var ownerIdInfo = this.scope.getBinding(this.ownerId.name);\n    return ownerIdInfo && !ownerIdInfo.constant;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.run = function run() {\n    var node = this.node;\n\n    // only tail recursion can be optimized as for now, so we can skip anonymous\n    // functions entirely\n    var ownerId = this.ownerId;\n    if (!ownerId) return;\n\n    // traverse the function and look for tail recursion\n    this.path.traverse(visitor, this);\n\n    // has no tail call recursion\n    if (!this.hasTailRecursion) return;\n\n    // the function binding isn't constant so we can't be sure that it's the same function :(\n    if (this.hasDeopt()) {\n      this.file.log.deopt(node, messages.get(\"tailCallReassignmentDeopt\"));\n      return;\n    }\n\n    //\n\n    var body = this.path.ensureBlock().body;\n\n    for (var i = 0; i < body.length; i++) {\n      var bodyNode = body[i];\n      if (!t.isFunctionDeclaration(bodyNode)) continue;\n\n      bodyNode = body[i] = t.variableDeclaration(\"var\", [t.variableDeclarator(bodyNode.id, t.toExpression(bodyNode))]);\n      bodyNode._blockHoist = 2;\n    }\n\n    var paramDecls = this.paramDecls;\n    if (paramDecls.length > 0) {\n      var paramDecl = t.variableDeclaration(\"var\", paramDecls);\n      paramDecl._blockHoist = Infinity;\n      body.unshift(paramDecl);\n    }\n\n    body.unshift(t.expressionStatement(t.assignmentExpression(\"=\", this.getAgainId(), t.literal(false))));\n\n    node.body = util.template(\"tail-call-body\", {\n      FUNCTION_ID: this.getFunctionId(),\n      AGAIN_ID: this.getAgainId(),\n      BLOCK: node.body\n    });\n\n    var topVars = [];\n\n    if (this.needsThis) {\n      var _arr = this.thisPaths;\n\n      for (var _i = 0; _i < _arr.length; _i++) {\n        var path = _arr[_i];\n        path.replaceWith(this.getThisId());\n      }\n\n      topVars.push(t.variableDeclarator(this.getThisId(), t.thisExpression()));\n    }\n\n    if (this.needsArguments || this.setsArguments) {\n      var _arr2 = this.argumentsPaths;\n\n      for (var _i2 = 0; _i2 < _arr2.length; _i2++) {\n        var _path = _arr2[_i2];\n        _path.replaceWith(this.argumentsId);\n      }\n\n      var decl = t.variableDeclarator(this.argumentsId);\n      if (this.argumentsId) {\n        decl.init = t.identifier(\"arguments\");\n        decl.init._shadowedFunctionLiteral = this.path;\n      }\n      topVars.push(decl);\n    }\n\n    var leftId = this.leftId;\n    if (leftId) {\n      topVars.push(t.variableDeclarator(leftId));\n    }\n\n    if (topVars.length > 0) {\n      node.body.body.unshift(t.variableDeclaration(\"var\", topVars));\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.subTransform = function subTransform(node) {\n    if (!node) return;\n\n    var handler = this[\"subTransform\" + node.type];\n    if (handler) return handler.call(this, node);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.subTransformConditionalExpression = function subTransformConditionalExpression(node) {\n    var callConsequent = this.subTransform(node.consequent);\n    var callAlternate = this.subTransform(node.alternate);\n    if (!callConsequent && !callAlternate) {\n      return;\n    }\n\n    // if ternary operator had tail recursion in value, convert to optimized if-statement\n    node.type = \"IfStatement\";\n    node.consequent = callConsequent ? t.toBlock(callConsequent) : returnBlock(node.consequent);\n\n    if (callAlternate) {\n      node.alternate = t.isIfStatement(callAlternate) ? callAlternate : t.toBlock(callAlternate);\n    } else {\n      node.alternate = returnBlock(node.alternate);\n    }\n\n    return [node];\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.subTransformLogicalExpression = function subTransformLogicalExpression(node) {\n    // only call in right-value of can be optimized\n    var callRight = this.subTransform(node.right);\n    if (!callRight) return;\n\n    // cache left value as it might have side-effects\n    var leftId = this.getLeftId();\n    var testExpr = t.assignmentExpression(\"=\", leftId, node.left);\n\n    if (node.operator === \"&&\") {\n      testExpr = t.unaryExpression(\"!\", testExpr);\n    }\n\n    return [t.ifStatement(testExpr, returnBlock(leftId))].concat(callRight);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.subTransformSequenceExpression = function subTransformSequenceExpression(node) {\n    var seq = node.expressions;\n\n    // only last element can be optimized\n    var lastCall = this.subTransform(seq[seq.length - 1]);\n    if (!lastCall) {\n      return;\n    }\n\n    // remove converted expression from sequence\n    // and convert to regular expression if needed\n    if (--seq.length === 1) {\n      node = seq[0];\n    }\n\n    return [t.expressionStatement(node)].concat(lastCall);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  TailCallTransformer.prototype.subTransformCallExpression = function subTransformCallExpression(node) {\n    var callee = node.callee;\n    var thisBinding, args;\n\n    if (t.isMemberExpression(callee, { computed: false }) && t.isIdentifier(callee.property)) {\n      switch (callee.property.name) {\n        case \"call\":\n          args = t.arrayExpression(node.arguments.slice(1));\n          break;\n\n        case \"apply\":\n          args = node.arguments[1] || t.identifier(\"undefined\");\n          this.needsArguments = true;\n          break;\n\n        default:\n          return;\n      }\n\n      thisBinding = node.arguments[0];\n      callee = callee.object;\n    }\n\n    // only tail recursion can be optimized as for now\n    if (!t.isIdentifier(callee) || !this.scope.bindingIdentifierEquals(callee.name, this.ownerId)) {\n      return;\n    }\n\n    this.hasTailRecursion = true;\n\n    if (this.hasDeopt()) return;\n\n    var body = [];\n\n    if (this.needsThis && !t.isThisExpression(thisBinding)) {\n      body.push(t.expressionStatement(t.assignmentExpression(\"=\", this.getThisId(), thisBinding || t.identifier(\"undefined\"))));\n    }\n\n    if (!args) {\n      args = t.arrayExpression(node.arguments);\n    }\n\n    var argumentsId = this.getArgumentsId();\n    var params = this.getParams();\n\n    if (this.needsArguments) {\n      body.push(t.expressionStatement(t.assignmentExpression(\"=\", argumentsId, args)));\n    }\n\n    if (t.isArrayExpression(args)) {\n      var elems = args.elements;\n\n      // pad out the args so all the function args are reset - https://github.com/babel/babel/issues/1938\n      while (elems.length < params.length) {\n        elems.push(t.identifier(\"undefined\"));\n      }\n\n      for (var i = 0; i < elems.length; i++) {\n        var param = params[i];\n        var elem = elems[i];\n\n        if (param && !param._isDefaultPlaceholder) {\n          elems[i] = t.assignmentExpression(\"=\", param, elem);\n        } else {\n          // exceeds parameters but push it anyway to ensure correct execution\n        }\n      }\n\n      if (!this.needsArguments) {\n        var _arr3 = elems;\n\n        for (var _i3 = 0; _i3 < _arr3.length; _i3++) {\n          var elem = _arr3[_i3];\n          // only push expressions that we really need, this will skip pure arguments that exceed the\n          // parameter length of the current function\n          if (!this.scope.isPure(elem)) {\n            body.push(t.expressionStatement(elem));\n          }\n        }\n      }\n    } else {\n      this.setsArguments = true;\n      for (var i = 0; i < params.length; i++) {\n        var param = params[i];\n        if (!param._isDefaultPlaceholder) {\n          body.push(t.expressionStatement(t.assignmentExpression(\"=\", param, t.memberExpression(argumentsId, t.literal(i), true))));\n        }\n      }\n    }\n\n    body.push(t.expressionStatement(t.assignmentExpression(\"=\", this.getAgainId(), t.literal(true))));\n\n    if (this.vars.length > 0) {\n      var declarations = _lodashArrayFlatten2[\"default\"](_lodashCollectionMap2[\"default\"](this.vars, function (decl) {\n        return decl.declarations;\n      }));\n\n      var assignment = _lodashCollectionReduceRight2[\"default\"](declarations, function (expr, decl) {\n        return t.assignmentExpression(\"=\", decl.id, expr);\n      }, t.identifier(\"undefined\"));\n\n      var statement = t.expressionStatement(assignment);\n      body.push(statement);\n    }\n\n    body.push(t.continueStatement(this.getFunctionId()));\n\n    return body;\n  };\n\n  return TailCallTransformer;\n})();"]}