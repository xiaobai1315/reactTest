{"version":3,"sources":["../../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/transformers/optimisation/modules.system.js"],"names":["exports","__esModule","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","_types","require","t","metadata","optional","group","visitor","Program","node","parent","scope","file","moduleFormatter","_setters","traverse","optimizeSettersVisitor","exportFunctionIdentifier","exportIdentifier","FunctionExpression","enter","state","hasExports","exportObjectIdentifier","generateUidIdentifier","exit","body","unshift","variableDeclaration","variableDeclarator","cloneDeep","objectExpression","push","expressionStatement","callExpression","CallExpression","isIdentifier","callee","name","memberNode","memberExpression","arguments","assignmentExpression"],"mappings":"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","file":"modules.system.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\nvar _types = require(\"../../../types\");\n\nvar t = _interopRequireWildcard(_types);\n\nvar metadata = {\n  optional: true,\n  group: \"builtin-trailing\"\n};\n\nexports.metadata = metadata;\nvar visitor = {\n  Program: function Program(node, parent, scope, file) {\n    if (file.moduleFormatter._setters) {\n      scope.traverse(file.moduleFormatter._setters, optimizeSettersVisitor, {\n        exportFunctionIdentifier: file.moduleFormatter.exportIdentifier\n      });\n    }\n  }\n};\n\nexports.visitor = visitor;\n/**\n * Setters are optimized to avoid slow export behavior in modules that rely on deep hierarchies\n * of export-from declarations.\n * More info in https://github.com/babel/babel/pull/1722 and\n * https://github.com/ModuleLoader/es6-module-loader/issues/386.\n *\n * TODO: Ideally this would be optimized during construction of the setters, but the current\n * architecture of the module formatters make that difficult.\n */\nvar optimizeSettersVisitor = {\n  FunctionExpression: {\n    enter: function enter(node, parent, scope, state) {\n      state.hasExports = false;\n      state.exportObjectIdentifier = scope.generateUidIdentifier(\"exportObj\");\n    },\n    exit: function exit(node, parent, scope, state) {\n      if (!state.hasExports) return;\n\n      node.body.body.unshift(t.variableDeclaration(\"var\", [t.variableDeclarator(t.cloneDeep(state.exportObjectIdentifier), t.objectExpression([]))]));\n      node.body.body.push(t.expressionStatement(t.callExpression(t.cloneDeep(state.exportFunctionIdentifier), [t.cloneDeep(state.exportObjectIdentifier)])));\n    }\n  },\n  CallExpression: function CallExpression(node, parent, scope, state) {\n    if (!t.isIdentifier(node.callee, { name: state.exportFunctionIdentifier.name })) return;\n\n    state.hasExports = true;\n    var memberNode = t.memberExpression(t.cloneDeep(state.exportObjectIdentifier), node.arguments[0], true);\n    return t.assignmentExpression(\"=\", memberNode, node.arguments[1]);\n  }\n};"]}