{"version":3,"sources":["../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/helpers/name-method.js"],"names":["exports","__esModule","custom","property","bare","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","_interopRequireDefault","_getFunctionArity","require","_getFunctionArity2","_util","util","_types","t","visitIdentifier","context","node","scope","state","name","localDeclar","getBindingIdentifier","outerDeclar","selfReference","stop","visitor","ReferencedIdentifier","parent","BindingIdentifier","wrap","method","id","hasBinding","hasGlobal","rename","templateName","generator","template","FUNCTION","FUNCTION_ID","FUNCTION_KEY","generateUidIdentifier","callee","_skipModulesRemap","params","body","i","len","push","getProgramParent","references","visit","selfAssignment","binding","getOwnBinding","kind","traverse","file","toComputedKey","isLiteral","toBindingIdentifierName","value","identifier","isProperty","computed","isVariableDeclarator","isIdentifier","getBinding","constant"],"mappings":"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","file":"name-method.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\nexports.custom = custom;\nexports.property = property;\nexports.bare = bare;\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _getFunctionArity = require(\"./get-function-arity\");\n\nvar _getFunctionArity2 = _interopRequireDefault(_getFunctionArity);\n\nvar _util = require(\"../../util\");\n\nvar util = _interopRequireWildcard(_util);\n\nvar _types = require(\"../../types\");\n\nvar t = _interopRequireWildcard(_types);\n\n/**\n * [Please add a description.]\n */\n\nfunction visitIdentifier(context, node, scope, state) {\n  // check if this node matches our function id\n  if (node.name !== state.name) return;\n\n  // check that we don't have a local variable declared as that removes the need\n  // for the wrapper\n  var localDeclar = scope.getBindingIdentifier(state.name);\n  if (localDeclar !== state.outerDeclar) return;\n\n  state.selfReference = true;\n  context.stop();\n}\n\n/**\n * [Please add a description.]\n */\n\nvar visitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  ReferencedIdentifier: function ReferencedIdentifier(node, parent, scope, state) {\n    visitIdentifier(this, node, scope, state);\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  BindingIdentifier: function BindingIdentifier(node, parent, scope, state) {\n    visitIdentifier(this, node, scope, state);\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar wrap = function wrap(state, method, id, scope) {\n  if (state.selfReference) {\n    if (scope.hasBinding(id.name) && !scope.hasGlobal(id.name)) {\n      // we can just munge the local binding\n      scope.rename(id.name);\n    } else {\n      // need to add a wrapper since we can't change the references\n      var templateName = \"property-method-assignment-wrapper\";\n      if (method.generator) templateName += \"-generator\";\n      var template = util.template(templateName, {\n        FUNCTION: method,\n        FUNCTION_ID: id,\n        FUNCTION_KEY: scope.generateUidIdentifier(id.name)\n      });\n      template.callee._skipModulesRemap = true;\n\n      // shim in dummy params to retain function arity, if you try to read the\n      // source then you'll get the original since it's proxied so it's all good\n      var params = template.callee.body.body[0].params;\n      for (var i = 0, len = _getFunctionArity2[\"default\"](method); i < len; i++) {\n        params.push(scope.generateUidIdentifier(\"x\"));\n      }\n\n      return template;\n    }\n  }\n\n  method.id = id;\n  scope.getProgramParent().references[id.name] = true;\n};\n\n/**\n * [Please add a description.]\n */\n\nvar visit = function visit(node, name, scope) {\n  var state = {\n    selfAssignment: false,\n    selfReference: false,\n    outerDeclar: scope.getBindingIdentifier(name),\n    references: [],\n    name: name\n  };\n\n  // check to see if we have a local binding of the id we're setting inside of\n  // the function, this is important as there are caveats associated\n\n  var binding = scope.getOwnBinding(name);\n\n  if (binding) {\n    if (binding.kind === \"param\") {\n      // safari will blow up in strict mode with code like:\n      //\n      //   var t = function t(t) {};\n      //\n      // with the error:\n      //\n      //   Cannot declare a parameter named 't' as it shadows the name of a\n      //   strict mode function.\n      //\n      // this isn't to the spec and they've invented this behaviour which is\n      // **extremely** annoying so we avoid setting the name if it has a param\n      // with the same id\n      state.selfReference = true;\n    } else {\n      // otherwise it's defined somewhere in scope like:\n      //\n      //   var t = function () {\n      //     var t = 2;\n      //   };\n      //\n      // so we can safely just set the id and move along as it shadows the\n      // bound function id\n    }\n  } else if (state.outerDeclar || scope.hasGlobal(name)) {\n      scope.traverse(node, visitor, state);\n    }\n\n  return state;\n};\n\n/**\n * [Please add a description.]\n */\n\nfunction custom(node, id, scope) {\n  var state = visit(node, id.name, scope);\n  return wrap(state, node, id, scope);\n}\n\n/**\n * [Please add a description.]\n */\n\nfunction property(node, file, scope) {\n  var key = t.toComputedKey(node, node.key);\n  if (!t.isLiteral(key)) return; // we can't set a function id with this\n\n  var name = t.toBindingIdentifierName(key.value);\n  var id = t.identifier(name);\n\n  var method = node.value;\n  var state = visit(method, name, scope);\n  node.value = wrap(state, method, id, scope) || method;\n}\n\n/**\n * [Please add a description.]\n */\n\nfunction bare(node, parent, scope) {\n  // has an `id` so we don't need to infer one\n  if (node.id) return;\n\n  var id;\n  if (t.isProperty(parent) && parent.kind === \"init\" && (!parent.computed || t.isLiteral(parent.key))) {\n    // { foo() {} };\n    id = parent.key;\n  } else if (t.isVariableDeclarator(parent)) {\n    // var foo = function () {};\n    id = parent.id;\n\n    if (t.isIdentifier(id)) {\n      var binding = scope.parent.getBinding(id.name);\n      if (binding && binding.constant && scope.getBinding(id.name) === binding) {\n        // always going to reference this method\n        node.id = id;\n        return;\n      }\n    }\n  } else {\n    return;\n  }\n\n  var name;\n  if (t.isLiteral(id)) {\n    name = id.value;\n  } else if (t.isIdentifier(id)) {\n    name = id.name;\n  } else {\n    return;\n  }\n\n  name = t.toBindingIdentifierName(name);\n  id = t.identifier(name);\n\n  var state = visit(node, name, scope);\n  return wrap(state, node, id, scope);\n}"]}