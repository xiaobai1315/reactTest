{"version":3,"sources":["../../../../../../../jspm_packages/npm/babel-core@5.8.38/lib/transformation/modules/system.js"],"names":["exports","__esModule","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","_interopRequireDefault","_classCallCheck","instance","Constructor","TypeError","_inherits","subClass","superClass","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_default","require","_default2","_amd","_amd2","_util","util","_lodashArrayLast","_lodashArrayLast2","_lodashCollectionMap","_lodashCollectionMap2","_types","t","hoistVariablesVisitor","Function","skip","VariableDeclaration","node","parent","scope","state","kind","isProgram","formatter","_canHoist","nodes","i","declarations","length","declar","hoistDeclarators","push","variableDeclarator","id","init","assign","expressionStatement","assignmentExpression","isFor","left","hoistFunctionsVisitor","enter","isFunctionDeclaration","handlerBody","dangerouslyRemove","runnerSettersVisitor","_importSource","source","isVariableDeclaration","_arr","_i","SystemFormatter","_AMDFormatter","file","_setters","exportIdentifier","generateUidIdentifier","noInteropRequireExport","noInteropRequireImport","remaps","clearAll","_addImportSource","exportNode","buildExportsWildcard","objectIdentifier","leftIdentifier","valIdentifier","memberExpression","variableDeclaration","right","block","blockStatement","ifStatement","binaryExpression","literal","_buildExportCall","forInStatement","buildExportsAssignment","name","buildExportsFromAssignment","apply","arguments","remapExportAssignment","exported","isStatement","callExpression","importSpecifier","specifier","_arr2","getAll","_i2","remap","identifier","_buildRunnerSetters","arrayExpression","ids","uid","traverse","functionExpression","_blockHoist","dynamicImports","transform","program","moduleName","getModuleName","moduleNameLiteral","body","setterListNode","runner","template","MODULE_DEPENDENCIES","buildDependencyLiterals","EXPORT_IDENTIFIER","MODULE_NAME","SETTERS","EXECUTE","expression","shift","returnStatement","pop","hoistDeclar","unshift","module"],"mappings":"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","file":"system.js","sourcesContent":["/* */ \n\"format cjs\";\n\"use strict\";\n\nexports.__esModule = true;\n// istanbul ignore next\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\n// istanbul ignore next\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n// istanbul ignore next\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n// istanbul ignore next\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar _default = require(\"./_default\");\n\nvar _default2 = _interopRequireDefault(_default);\n\nvar _amd = require(\"./amd\");\n\nvar _amd2 = _interopRequireDefault(_amd);\n\nvar _util = require(\"../../util\");\n\nvar util = _interopRequireWildcard(_util);\n\nvar _lodashArrayLast = require(\"lodash/array/last\");\n\nvar _lodashArrayLast2 = _interopRequireDefault(_lodashArrayLast);\n\nvar _lodashCollectionMap = require(\"lodash/collection/map\");\n\nvar _lodashCollectionMap2 = _interopRequireDefault(_lodashCollectionMap);\n\nvar _types = require(\"../../types\");\n\nvar t = _interopRequireWildcard(_types);\n\n/**\n * [Please add a description.]\n */\n\nvar hoistVariablesVisitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  Function: function Function() {\n    // nothing inside is accessible\n    this.skip();\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  VariableDeclaration: function VariableDeclaration(node, parent, scope, state) {\n    if (node.kind !== \"var\" && !t.isProgram(parent)) {\n      // let, const\n      // can't be accessed\n      return;\n    }\n\n    // ignore block hoisted nodes as these can be left in\n    if (state.formatter._canHoist(node)) return;\n\n    var nodes = [];\n\n    for (var i = 0; i < node.declarations.length; i++) {\n      var declar = node.declarations[i];\n      state.hoistDeclarators.push(t.variableDeclarator(declar.id));\n      if (declar.init) {\n        // no initializer so we can just hoist it as-is\n        var assign = t.expressionStatement(t.assignmentExpression(\"=\", declar.id, declar.init));\n        nodes.push(assign);\n      }\n    }\n\n    // for (var i in test)\n    if (t.isFor(parent) && parent.left === node) {\n      return node.declarations[0].id;\n    }\n\n    return nodes;\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar hoistFunctionsVisitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  Function: function Function() {\n    this.skip();\n  },\n\n  /**\n   * [Please add a description.]\n   */\n\n  enter: function enter(node, parent, scope, state) {\n    if (t.isFunctionDeclaration(node) || state.formatter._canHoist(node)) {\n      state.handlerBody.push(node);\n      this.dangerouslyRemove();\n    }\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar runnerSettersVisitor = {\n\n  /**\n   * [Please add a description.]\n   */\n\n  enter: function enter(node, parent, scope, state) {\n    if (node._importSource === state.source) {\n      if (t.isVariableDeclaration(node)) {\n        var _arr = node.declarations;\n\n        for (var _i = 0; _i < _arr.length; _i++) {\n          var declar = _arr[_i];\n          state.hoistDeclarators.push(t.variableDeclarator(declar.id));\n          state.nodes.push(t.expressionStatement(t.assignmentExpression(\"=\", declar.id, declar.init)));\n        }\n      } else {\n        state.nodes.push(node);\n      }\n\n      this.dangerouslyRemove();\n    }\n  }\n};\n\n/**\n * [Please add a description.]\n */\n\nvar SystemFormatter = (function (_AMDFormatter) {\n  _inherits(SystemFormatter, _AMDFormatter);\n\n  function SystemFormatter(file) {\n    _classCallCheck(this, SystemFormatter);\n\n    _AMDFormatter.call(this, file);\n\n    this._setters = null;\n    this.exportIdentifier = file.scope.generateUidIdentifier(\"export\");\n    this.noInteropRequireExport = true;\n    this.noInteropRequireImport = true;\n\n    this.remaps.clearAll();\n  }\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype._addImportSource = function _addImportSource(node, exportNode) {\n    if (node) node._importSource = exportNode.source && exportNode.source.value;\n    return node;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.buildExportsWildcard = function buildExportsWildcard(objectIdentifier, node) {\n    var leftIdentifier = this.scope.generateUidIdentifier(\"key\");\n    var valIdentifier = t.memberExpression(objectIdentifier, leftIdentifier, true);\n\n    var left = t.variableDeclaration(\"var\", [t.variableDeclarator(leftIdentifier)]);\n\n    var right = objectIdentifier;\n\n    var block = t.blockStatement([t.ifStatement(t.binaryExpression(\"!==\", leftIdentifier, t.literal(\"default\")), t.expressionStatement(this._buildExportCall(leftIdentifier, valIdentifier)))]);\n\n    return this._addImportSource(t.forInStatement(left, right, block), node);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.buildExportsAssignment = function buildExportsAssignment(id, init, node) {\n    var call = this._buildExportCall(t.literal(id.name), init, true);\n    return this._addImportSource(call, node);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.buildExportsFromAssignment = function buildExportsFromAssignment() {\n    return this.buildExportsAssignment.apply(this, arguments);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.remapExportAssignment = function remapExportAssignment(node, exported) {\n    var assign = node;\n\n    for (var i = 0; i < exported.length; i++) {\n      assign = this._buildExportCall(t.literal(exported[i].name), assign);\n    }\n\n    return assign;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype._buildExportCall = function _buildExportCall(id, init, isStatement) {\n    var call = t.callExpression(this.exportIdentifier, [id, init]);\n    if (isStatement) {\n      return t.expressionStatement(call);\n    } else {\n      return call;\n    }\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.importSpecifier = function importSpecifier(specifier, node, nodes) {\n    _amd2[\"default\"].prototype.importSpecifier.apply(this, arguments);\n\n    var _arr2 = this.remaps.getAll();\n\n    for (var _i2 = 0; _i2 < _arr2.length; _i2++) {\n      var remap = _arr2[_i2];\n      nodes.push(t.variableDeclaration(\"var\", [t.variableDeclarator(t.identifier(remap.name), remap.node)]));\n    }\n\n    this.remaps.clearAll();\n\n    this._addImportSource(_lodashArrayLast2[\"default\"](nodes), node);\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype._buildRunnerSetters = function _buildRunnerSetters(block, hoistDeclarators) {\n    var scope = this.file.scope;\n\n    return t.arrayExpression(_lodashCollectionMap2[\"default\"](this.ids, function (uid, source) {\n      var state = {\n        hoistDeclarators: hoistDeclarators,\n        source: source,\n        nodes: []\n      };\n\n      scope.traverse(block, runnerSettersVisitor, state);\n\n      return t.functionExpression(null, [uid], t.blockStatement(state.nodes));\n    }));\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype._canHoist = function _canHoist(node) {\n    return node._blockHoist && !this.file.dynamicImports.length;\n  };\n\n  /**\n   * [Please add a description.]\n   */\n\n  SystemFormatter.prototype.transform = function transform(program) {\n    _default2[\"default\"].prototype.transform.apply(this, arguments);\n\n    var hoistDeclarators = [];\n    var moduleName = this.getModuleName();\n    var moduleNameLiteral = t.literal(moduleName);\n\n    var block = t.blockStatement(program.body);\n\n    var setterListNode = this._buildRunnerSetters(block, hoistDeclarators);\n    this._setters = setterListNode;\n\n    var runner = util.template(\"system\", {\n      MODULE_DEPENDENCIES: t.arrayExpression(this.buildDependencyLiterals()),\n      EXPORT_IDENTIFIER: this.exportIdentifier,\n      MODULE_NAME: moduleNameLiteral,\n      SETTERS: setterListNode,\n      EXECUTE: t.functionExpression(null, [], block)\n    }, true);\n\n    var handlerBody = runner.expression.arguments[2].body.body;\n    if (!moduleName) runner.expression.arguments.shift();\n\n    var returnStatement = handlerBody.pop();\n\n    // hoist up all variable declarations\n    this.file.scope.traverse(block, hoistVariablesVisitor, {\n      formatter: this,\n      hoistDeclarators: hoistDeclarators\n    });\n\n    if (hoistDeclarators.length) {\n      var hoistDeclar = t.variableDeclaration(\"var\", hoistDeclarators);\n      hoistDeclar._blockHoist = true;\n      handlerBody.unshift(hoistDeclar);\n    }\n\n    // hoist up function declarations for circular references\n    this.file.scope.traverse(block, hoistFunctionsVisitor, {\n      formatter: this,\n      handlerBody: handlerBody\n    });\n\n    handlerBody.push(returnStatement);\n\n    program.body = [runner];\n  };\n\n  return SystemFormatter;\n})(_amd2[\"default\"]);\n\nexports[\"default\"] = SystemFormatter;\nmodule.exports = exports[\"default\"];"]}